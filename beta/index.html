<!DOCTYPE html>
<html lang="ja">
<head>
<meta http-equiv="Content-Security-Policy" content="default-src 'self'; connect-src 'self' https://script.google.com https://script.googleusercontent.com; script-src 'self' https://cdn.tailwindcss.com 'unsafe-inline' 'unsafe-eval'; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com; font-src 'self' https://fonts.gstatic.com; img-src 'self' data:; media-src 'self';">
<meta name="referrer" content="strict-origin-when-cross-origin">
<link rel="preload" as="image" href="../assets/blueberry.svg">
<link rel="preload" as="image" href="../assets/sunflower.svg">
<link rel="preload" as="image" href="../assets/Donguri.svg">
<link rel="preload" as="audio" href="../assets/BGM.mp3">
<link rel="preload" as="audio" href="../assets/END.mp3">
<link rel="preload" as="audio" href="../assets/HIGHEND.mp3"><!-- â˜…è¿½åŠ  -->
<link rel="preload" as="audio" href="../assets/pick.mp3">
<link rel="preload" as="audio" href="../assets/CREDIT.mp3">
<link rel="preload" as="audio" href="../assets/BGM2.mp3">
<link rel="preload" as="audio" href="../assets/SE.mp3">




<!-- ğŸŒ»ğŸŒ»ğŸŒ» è¿½åŠ ã²ã¾ã‚ã‚Š ğŸŒ»ğŸŒ»ğŸŒ» -->
<link rel="preload" as="image" href="../assets/sunflower2.png">
  
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
<title>ã‚€ã‚‹ã ã£ã—ã‚…ï¼</title>
  
<!-- ğŸŒ» ãƒ•ã‚¡ãƒ“ã‚³ãƒ³ï¼ˆã²ã¾ã‚ã‚ŠSVGï¼‰â€»ãƒ™ãƒ¼ã‚¿ã‹ã‚‰è¦‹ã¦ä¸€å€‹ä¸Šã® assets -->
<link rel="icon" type="image/svg+xml" href="../assets/sunflower.svg">

<!-- ğŸªª OGP / Twitterã‚«ãƒ¼ãƒ‰ï¼ˆãƒ™ãƒ¼ã‚¿ç‰ˆã¨ã—ã¦ã‚·ã‚§ã‚¢ã•ã‚Œã‚‹æƒ³å®šï¼‰ -->
<meta property="og:title" content="ã‚€ã‚‹ã ã£ã—ã‚…ï¼Î²ç‰ˆ">
<meta property="og:description" content="è¿«ã‚Šãã‚‹ã²ã¾ã‚ã‚Šã‚„ãƒ–ãƒ«ãƒ¼ãƒ™ãƒªãƒ¼ã‚’ã‚ˆã‘ã¾ãã‚‹ãƒ–ãƒ©ã‚¦ã‚¶ãƒ©ãƒ³ã‚²ãƒ¼ãƒ ï¼ˆãƒ™ãƒ¼ã‚¿ç‰ˆï¼‰ã€‚">
<meta property="og:type" content="website">

<!-- ãƒ™ãƒ¼ã‚¿ç‰ˆã®URL -->
<meta property="og:url" content="https://t4l-ovo-t4l.github.io/murudash/beta/">

<!-- OGPç”»åƒï¼ˆassets/OGP.png ã«ç½®ãå ´åˆï¼‰ -->
<meta property="og:image" content="https://t4l-ovo-t4l.github.io/murudash/assets/OGP.png">

<meta property="og:site_name" content="ã‚€ã‚‹ã ã£ã—ã‚…ï¼">
<meta name="twitter:card" content="summary_large_image">



  
<script src="https://cdn.tailwindcss.com"></script>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap');
  body { font-family:'Inter',sans-serif; touch-action:manipulation; overflow:hidden; overscroll-behavior:none; background:#1a202c; }
  
  canvas {
    display: block;
    width: 100%;   /* è¦ªè¦ç´ ã«ãƒ•ã‚£ãƒƒãƒˆã•ã›ã‚‹ */
    height: auto;  /* ç¸¦æ¨ªæ¯”ã¯ 768x300 ã®ã¾ã¾ç¶­æŒ */
  }

  .control-button { transition: background-color .1s, transform .1s; }
  .control-button:active { transform: scale(.95); background:#2c5282; }
  .pause-button { transition: background-color .1s, transform .1s; }
  .pause-button:active { transform: scale(.95); }
  .icon-inline { display:inline-block; width:1.15em; height:1.15em; vertical-align:-0.18em; margin-left:.25em; }
  .no-select { user-select:none; -webkit-user-select:none; -webkit-touch-callout:none; }
  .no-highlight { -webkit-tap-highlight-color:transparent; }

    /* å…¨é¢é¸æŠä¸å¯ï¼ˆå­å­«ã”ã¨ï¼‰ï¼†iOSé•·æŠ¼ã—ãƒ¡ãƒ‹ãƒ¥ãƒ¼ç„¡åŠ¹ */
  .no-select, .no-select * {
    user-select: none;
    -webkit-user-select: none;
    -webkit-touch-callout: none;
    -moz-user-select: none;
    -ms-user-select: none;
  }
  /* ã‚­ãƒ£ãƒ³ãƒã‚¹ã‚„ç”»åƒã€ãƒœã‚¿ãƒ³ã€ãƒªãƒ³ã‚¯ã‚‚å€‹åˆ¥ã«ã‚±ã‚¢ */
  canvas, img, button, a {
    -webkit-user-select: none;
    -webkit-touch-callout: none;
  }

@keyframes credits-scroll {
  /* æœ€åˆã‹ã‚‰ç”»é¢å†…ã«ã„ã‚‹çŠ¶æ…‹ï¼ˆã¡ã‚‡ã„ä¸‹ã‹ã‚‰ã§ã‚‚OKï¼‰ */
  0% {
    transform: translateY(20%);
    /* ã‚‚ã£ã¨ä¸‹ã‹ã‚‰å‡ºã—ãŸã‹ã£ãŸã‚‰ 20% ã¨ã‹ 40% ã¨ã‹ã§ã‚‚OK */
    /* transform: translateY(40%); ã¿ãŸã„ãªæ„Ÿã˜ */
  }

  /* ä¸Šã«æŠœã‘ã‚‹ä½ç½® */
  100% {
    transform: translateY(-120%);
  }
}

.credits-scroll {
  animation: credits-scroll 80s linear;
  animation-delay: 0s;  /* ã‚¯ãƒ¬ã‚¸ãƒƒãƒˆ é–‹å§‹ä½ç½® æŒ‡å®šæ™‚é–“é€²ã‚“ã çŠ¶æ…‹ã‹ã‚‰ã‚¹ã‚¿ãƒ¼ãƒˆ */
}





.rainbow-text {
  /* ãƒ‰åŸè‰²ãƒ¬ã‚¤ãƒ³ãƒœãƒ¼ï¼ˆå½©åº¦é«˜ã‚ï¼‰ */
  background: linear-gradient(
    90deg,
    #ff0000,
    #ff7a00,
    #fff500,
    #00ff00,
    #00f5ff,
    #0040ff,
    #c300ff,
    #ff0000
  );
  background-size: 320% 320%;
  background-position: 0% 50%;
  background-repeat: no-repeat;

  -webkit-background-clip: text;
  background-clip: text;
  color: transparent;
  -webkit-text-fill-color: transparent;


text-shadow:
  0 0 2px rgba(255, 255, 255, 0.20),
  0 0 6px rgba(255, 255, 255, 0.12);


  /* å¾€å¾©ã‚¢ãƒ‹ãƒ¡ã§ã‚¬ã‚¯ã£ã¨ã—ãªã„ã‚ˆã†ã« */
  animation: rainbow-slide 3s linear infinite alternate;
}

@keyframes rainbow-slide {
  from { background-position: 0% 50%; }
  to   { background-position: 100% 50%; }
}




</style>
</head>

<body class="bg-gray-800 flex flex-col items-center justify-start min-h-screen pt-3 sm:pt-4 pb-28 no-select no-highlight">

  
<!-- æ³¨è¨˜ -->
<div class="w-full text-center bg-gray-900 text-gray-300 text-[11px] py-1 shadow-md">
  â€»æœ¬ä½œå“ã¯ <a href="https://kuronekotsuki.booth.pm/items/4672957" target="_blank" rel="noopener noreferrer" class="underline hover:text-white transition">ï½¢ãƒ ãƒ«ãƒ«ï½£</a> ã‚’ãƒ¢ãƒãƒ¼ãƒ•ã«ã—ãŸéå…¬å¼ãƒ•ã‚¡ãƒ³ä½œå“ã§ã™ã€‚<br class="sm:hidden">
  æ¨©åˆ©è€…æ§˜ã¨ã¯ä¸€åˆ‡é–¢ä¿‚ã‚ã‚Šã¾ã›ã‚“ã€‚<br>
  â€»éŸ³ãŒå‡ºã¾ã™ã€‚ã”æ³¨æ„ãã ã•ã„ã€‚
</div>

<!-- ãƒ˜ãƒƒãƒ€ãƒ¼ï¼ˆ768pxãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆï¼‰ -->
<div class="w-full max-w-[768px] p-3 bg-white rounded-t-lg shadow-md">
  <div class="flex items-center justify-between gap-3">
    <div class="text-left">
      
      <span id="scoreLabel" class="text-xl sm:text-2xl font-bold text-blue-600">
        ã‚¹ã‚³ã‚¢: <span id="score" class="inline-block min-w-[60px] text-right font-mono">0</span>
      </span>

    </div>
    <div class="flex items-center gap-3 shrink-0">
      <span id="highScore" class="text-xs text-gray-500 block">ãƒã‚¤ã‚¹ã‚³ã‚¢: 0</span>

        <!-- ğŸ”‡ ãƒŸãƒ¥ãƒ¼ãƒˆãƒœã‚¿ãƒ³è¿½åŠ  -->
      <button
        id="muteButton"
        class="px-2 py-2 bg-gray-700 text-white rounded-lg text-xs sm:text-sm shadow-md"
      >
        ğŸ”Š
      </button>

      <button id="pauseButton" class="pause-button px-3 py-2 sm:px-4 sm:py-2 bg-yellow-500 text-white font-bold rounded-lg shadow-md text-sm">
        ã¡ã‚‡ã£ã¡ä¼‘æ†©
      </button>
    </div>
  </div>
</div>

<!-- ã‚­ãƒ£ãƒ³ãƒã‚¹ï¼†ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ -->
<div class="relative w-full max-w-[768px] mt-2">
  <canvas id="gameCanvas" class="rounded-b-lg shadow-md"></canvas>

  <div
    id="highScoreBanner"
    class="pointer-events-none absolute top-4 left-1/2 -translate-x-1/2
           px-4 py-2 text-xl sm:text-2xl font-extrabold tracking-wide
           hidden rainbow-text whitespace-nowrap"
  >
    ãƒã‚¤ã‚¹ã‚³ã‚¢æ›´æ–°ä¸­ã‚€ã‚‹ï½ï¼
  </div>


  <!-- ãƒ©ãƒ³ã‚­ãƒ³ã‚°ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ -->
<div id="rankingOverlay"
     class="absolute inset-0 bg-black bg-opacity-80 rounded-lg text-white hidden z-50">
  <div class="w-full h-full flex flex-col items-center justify-center px-4">
    <div class="w-full max-w-[600px] max-h-[80%] bg-gray-900/80 rounded-lg p-4 overflow-y-auto">
      <h2 class="text-2xl font-bold mb-3 text-center">ãƒ©ãƒ³ã‚­ãƒ³ã‚°</h2>
      <div id="rankingContent" class="text-sm sm:text-base space-y-1">
        <!-- JSã§ä¸­èº«ã‚’åŸ‹ã‚ã‚‹ -->
      </div>
      <div class="mt-4 text-center">
        <button id="closeRankingButton"
                class="px-6 py-2 bg-gray-700 hover:bg-gray-800 rounded-lg text-sm">
          ã¨ã˜ã‚‹
        </button>
      </div>
    </div>
  </div>
</div>

  <!-- â˜… ãƒã‚¤ã‚¹ã‚³ã‚¢ãƒªã‚»ãƒƒãƒˆç¢ºèªã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ -->
  <div id="resetConfirmOverlay"
       class="absolute inset-0 bg-black bg-opacity-70 rounded-b-lg text-white hidden z-50">
    <div class="w-full h-full flex flex-col items-center justify-center px-4">
      <div class="w-full max-w-[480px] bg-gray-900 rounded-lg p-5 shadow-lg">
        <h2 class="text-xl font-bold mb-3 text-center">ãƒã‚¤ã‚¹ã‚³ã‚¢ã®ãƒªã‚»ãƒƒãƒˆ</h2>
        <p class="text-sm sm:text-base mb-4 text-center">
          ãƒã‚¤ã‚¹ã‚³ã‚¢ã‚’æ¶ˆå»ã—ã¾ã™ã‹ï¼Ÿ<br>
          ã“ã®æ“ä½œã¯å–ã‚Šæ¶ˆã›ã¾ã›ã‚“ã€‚
        </p>
        <div class="flex flex-col sm:flex-row gap-3 mt-2">
          <button
            id="confirmResetButton"
            class="flex-1 px-4 py-2 bg-red-600 hover:bg-red-700 rounded-lg text-sm font-bold"
          >
            æ¶ˆå»ã™ã‚‹
          </button>
          <button
            id="cancelResetButton"
            class="flex-1 px-4 py-2 bg-gray-600 hover:bg-gray-700 rounded-lg text-sm font-bold"
          >
            ã—ãªã„ã‚€ã‚‹
          </button>
        </div>
      </div>
    </div>
  </div>


  
  <!-- ã‚¹ã‚¿ãƒ¼ãƒˆ -->
  <div
  id="startScreen"
  class="absolute inset-0 bg-black bg-opacity-70 rounded-b-lg text-white text-center
         flex flex-col items-center
         px-6 pb-20          <!-- â˜… ã“ã“å¢—é‡ -->
         justify-center      <!-- â˜… ã“ã“å¤‰æ›´ï¼šæœ€åˆã‹ã‚‰ä¸­å¤®å¯„ã› -->
         sm:justify-center sm:pt-0"
>


    <h2 class="text-4xl sm:text-5xl font-bold mb-6">ã‚€ã‚‹ã ã£ã—ã‚…ï¼</h2>
    
    <p class="text-sm sm:text-lg mb-3">
      ãƒœã‚¿ãƒ³ã§ã‚¸ãƒ£ãƒ³ãƒ—ï¼<br class="sm:hidden">ç©ºä¸­ã§ã‚‚ã†ä¸€å›ã§2æ®µã‚¸ãƒ£ãƒ³ãƒ—ï¼
    </p>
    
    <p class="text-sm sm:text-lg mb-6">
      éšœå®³ç‰©ã‚’ã‚ˆã‘ã¾ãã‚ã†ï¼
    </p>

    <!-- ã‚¯ãƒ¬ã‚¸ãƒƒãƒˆ ï¼‹ ãƒªã‚»ãƒƒãƒˆï¼ˆæ¨ªä¸¦ã³ï¼‰ -->
    <div class="mt-4 flex flex-row flex-wrap gap-3 justify-center">
  <button id="creditsButton" class="px-5 py-2 border border-gray-300 text-sm rounded-lg bg-black/40 hover:bg-black/60 transition-colors">
    ã‚¯ãƒ¬ã‚¸ãƒƒãƒˆ
  </button>
  <button id="resetButton" class="px-5 py-2 border border-red-400 text-sm rounded-lg bg-red-600/80 hover:bg-red-700 transition-colors">
    ãƒªã‚»ãƒƒãƒˆ
  </button>
</div>


  </div>


  <!-- ãƒãƒ¼ã‚º -->
  <div id="pauseOverlay" class="absolute inset-0 bg-black bg-opacity-50 flex-col justify-center items-center rounded-b-lg text-white p-8 text-center hidden">
    <h2 class="text-4xl font-bold mb-4">ä¸€æ™‚åœæ­¢ä¸­</h2>
    <p class="text-xl">(ã€Œã¡ã‚‡ã£ã¡ä¼‘æ†©ã€ãƒœã‚¿ãƒ³ã§å†é–‹)</p>
  </div>

<!-- ã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼ -->
<div
  id="gameOverScreen"
  class="absolute inset-0 bg-black bg-opacity-50 rounded-lg text-white hidden z-40"
>
  <div class="w-full h-full flex flex-col items-center px-4 gap-8
              justify-start pt-10 sm:justify-center sm:pt-0">


    <!-- ä¸Šå´ï¼šã‚¿ã‚¤ãƒˆãƒ« ï¼‹ ã‚¹ã‚³ã‚¢ï¼ˆä¸­å¤®å›ºå®šï¼‰ -->
    <div class="text-center">
      <h2 class="text-4xl font-bold mb-2">ãŒã‚ãŠã¹ã‚‰</h2>

      <p
        id="gameOverHighScoreLabel"
        class="text-lg mb-1 text-yellow-300 font-bold hidden"
      >
        ãƒã‚¤ã‚¹ã‚³ã‚¢æ›´æ–°ã‚€ã‚‹ï½ï¼
      </p>

      <p class="text-xl">
        ã‚¹ã‚³ã‚¢: <span id="finalScore">0</span>
      </p>
    </div>

    <!-- ä¸‹å´ï¼šãƒœã‚¿ãƒ³ç¾¤ï¼ˆã‚¹ãƒãƒ›ã§ã‚‚æ½°ã‚Œãªã„ï¼‰ -->
    <div class="w-full max-w-[480px] space-y-4">

      <a
        id="shareButton"
        href="#"
        target="_blank"
        rel="noopener noreferrer"
        class="block w-full px-6 py-3 bg-black text-white font-bold rounded-lg shadow-lg text-lg text-center hover:bg-gray-900 transition-colors"
      >
        Xã§ã‚¹ã‚³ã‚¢ã‚’ã‚·ã‚§ã‚¢
      </a>

      <button
        id="sendScoreButton"
        class="block w-full px-6 py-3 bg-blue-600 text-white font-bold rounded-lg shadow-lg text-lg hover:bg-blue-700 transition-colors"
      >
        ãƒ©ãƒ³ã‚­ãƒ³ã‚°ã«é€ä¿¡
      </button>

      <button
        id="viewRankingButton"
        class="block w-full px-6 py-3 bg-gray-700 text-white font-bold rounded-lg shadow-lg text-lg hover:bg-gray-800 transition-colors"
      >
        ãƒ©ãƒ³ã‚­ãƒ³ã‚°ã‚’è¦‹ã‚‹
      </button>

      <!-- é€ä¿¡ä¸­ãƒ»å®Œäº†ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ -->
      <p
        id="sendStatusMessage"
        class="text-center text-sm text-gray-200"
      ></p>

    </div>

  </div>
</div>







  
<!-- ã‚¯ãƒ¬ã‚¸ãƒƒãƒˆï¼ˆã‚¹ã‚¿ãƒƒãƒ•ãƒ­ãƒ¼ãƒ«ï¼ã‚²ãƒ¼ãƒ ç”»é¢ãƒ•ãƒ«ï¼‰ -->
<div id="creditsOverlay" class="absolute inset-0 bg-black bg-opacity-90 rounded-b-lg text-white hidden">
  <div class="relative w-full h-full overflow-hidden">

    <!-- å¤–å´ï¼šä½ç½®ã ã‘æ‹…å½“ï¼ˆXæ–¹å‘ã‚»ãƒ³ã‚¿ãƒªãƒ³ã‚°ï¼‰ -->
    <div
      id="creditsScrollOuter"
      class="absolute left-1/2 -translate-x-1/2 w-full max-w-[720px] text-white"
    >

      <!-- å†…å´ï¼šã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³æ‹…å½“ï¼ˆYæ–¹å‘ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ï¼‰ -->
      <div id="creditsScroll" class="credits-scroll">
        <div class="relative mx-auto max-w-[720px] px-4 text-white">
      
          <!-- ğŸ“ çœŸã‚“ä¸­ï¼šã‚¯ãƒ¬ã‚¸ãƒƒãƒˆãƒ†ã‚­ã‚¹ãƒˆ -->
          <div class="text-center text-white">

  <!-- ã‚¿ã‚¤ãƒˆãƒ« -->
  <div class="text-center text-white">

  <!-- ã‚¿ã‚¤ãƒˆãƒ« -->
  <p class="mt-4 text-xl font-bold">
    ã‚€ã‚‹ã ã£ã—ã‚…ï¼ ã‚¯ãƒ¬ã‚¸ãƒƒãƒˆ
  </p>

  <!-- ä¼ç”»ãƒ»åˆ¶ä½œ -->
  <div class="mt-8">
    <p class="text-xs text-gray-400">ä¼ç”»ãƒ»åˆ¶ä½œ</p>
    <p class="mt-1 text-base">ãŸã‚‹</p>
  </div>

  <!-- ãƒ‡ã‚£ãƒ¬ã‚¯ã‚¿ãƒ¼ -->
  <div class="mt-10">
    <p class="text-xs text-gray-400">ãƒ‡ã‚£ãƒ¬ã‚¯ã‚¿ãƒ¼</p>
    <p class="mt-1 text-base">ãŸã‚‹</p>
  </div>

  <!-- ã‚²ãƒ¼ãƒ ãƒ‡ã‚¶ã‚¤ãƒ³ -->
  <div class="mt-10">
    <p class="text-xs text-gray-400">ã‚²ãƒ¼ãƒ ãƒ‡ã‚¶ã‚¤ãƒ³</p>
    <p class="mt-1 text-base">ãŸã‚‹</p>
  </div>

  <!-- ãƒ—ãƒ­ã‚°ãƒ©ãƒ  -->
  <div class="mt-10">
    <p class="text-xs text-gray-400">ãƒ—ãƒ­ã‚°ãƒ©ãƒ </p>
    <p class="mt-1 text-base">ãŸã‚‹ with ChatGPT</p>
  </div>

  <!-- ã‚°ãƒ©ãƒ•ã‚£ãƒƒã‚¯ -->
  <div class="mt-10">
    <p class="text-xs text-gray-400">ã‚°ãƒ©ãƒ•ã‚£ãƒƒã‚¯</p>
    <p class="mt-1 text-base leading-relaxed">
      ãŸã‚‹<br>
      â—¯â—¯â—¯<br>
      ã‚¤ãƒ©ã‚¹ãƒˆAC<br>
      Twemojiï¼ˆCC BY 4.0ï¼‰
    </p>
  </div>

  <!-- ã‚µã‚¦ãƒ³ãƒ‰ -->
  <div class="mt-10">
    <p class="text-xs text-gray-400">ã‚µã‚¦ãƒ³ãƒ‰</p>
    <p class="mt-1 text-base leading-relaxed">
      ãŸã‚‹ made with Suno<br>
      Audiostock
    </p>
  </div>

  <!-- ãƒ†ã‚¹ãƒˆãƒ—ãƒ¬ã‚¤ -->
  <div class="mt-10">
    <p class="text-xs text-gray-400">ãƒ†ã‚¹ãƒˆãƒ—ãƒ¬ã‚¤</p>
    <p class="mt-1 text-base leading-relaxed">
      ã‚†ãšã†ã«ï¼ˆXï¼š@yzun_vï¼‰<br>
      â—¯â—¯â—¯ï¼ˆXï¼šâ—¯â—¯â—¯ï¼‰
    </p>
  </div>

  <!-- ã‚¤ãƒ³ã‚¹ãƒ‘ã‚¤ã‚¢ & ãƒªã‚¹ãƒšã‚¯ãƒˆ -->
  <div class="mt-10">
    <p class="text-xs text-gray-400">ã‚¤ãƒ³ã‚¹ãƒ‘ã‚¤ã‚¢ &amp; ãƒªã‚¹ãƒšã‚¯ãƒˆ</p>
    <p class="mt-1 text-base">Google - Dinosaur Game</p>
  </div>

  <!-- ã‚¹ãƒšã‚·ãƒ£ãƒ«ã‚µãƒ³ã‚¯ã‚¹ -->
  <div class="mt-10">
    <p class="text-xs text-gray-400">ã‚¹ãƒšã‚·ãƒ£ãƒ«ã‚µãƒ³ã‚¯ã‚¹</p>
    <p class="mt-1 text-base leading-relaxed">
      ãã‚ã‚€ï¼ˆLethal Catsï¼‰â€“ ï½¢ãƒ ãƒ«ãƒ«ï½£åŸæ¡ˆ<br>
      å…¨ãƒ ãƒ«ãƒ«ãŸã¡
    </p>
  </div>

  <!-- ä½¿ç”¨ãƒ„ãƒ¼ãƒ« -->
  <div class="mt-10">
    <p class="text-xs text-gray-400">ä½¿ç”¨ãƒ„ãƒ¼ãƒ«</p>
    <p class="mt-1 text-base leading-relaxed">
      HTML5 / JavaScriptï¼ˆVanillaï¼‰<br>
      Tailwind CSS<br>
      GitHub Pages<br>
      Google Apps Script<br>
      Google Spreadsheet<br>
      Suno<br>
      ChatGPT
    </p>
  </div>

  <!-- ã‚³ãƒ”ãƒ¼ãƒ©ã‚¤ãƒˆ -->
  <p class="mt-16 text-sm">
    Â© 2025 T4L All Rights Reserved.
  </p>

  <p class="mt-4 text-xs text-gray-300 leading-relaxed">
    â€»æœ¬ä½œå“ã¯ã€Œãƒ ãƒ«ãƒ«ã€ã‚’ãƒ¢ãƒãƒ¼ãƒ•ã«ã—ãŸéå…¬å¼ãƒ•ã‚¡ãƒ³ä½œå“ã§ã™ã€‚<br>
    ã€€æ¨©åˆ©è€…æ§˜ã¨ã¯ä¸€åˆ‡é–¢ä¿‚ã‚ã‚Šã¾ã›ã‚“ã€‚
  </p>

</div>


</div>




          </div>
      
          <!-- ğŸ¨ é£¾ã‚Šã‚¤ãƒ©ã‚¹ãƒˆ -->
<!-- â‘  ã¡ã‚‡ã„ä¸Šã®æ–¹ãƒ»å³ã«è‡ªæ©Ÿ -->
<img
  src="../assets/Muru.png"
  alt="Muru"
  class="absolute right-1 sm:right-2 top-16 w-16 sm:w-24 pointer-events-none select-none"
/>

<!-- â‘¡ ãã®ã ã„ã¶ä¸‹ãƒ»å·¦ã«ã²ã¾ã‚ã‚Š -->
<img
  src="../assets/sunflower.svg"
  alt="sunflower"
  class="absolute left-1 sm:left-2 top-[260px] w-12 sm:w-16 h-auto pointer-events-none select-none"
/>

<!-- â‘¢ ã•ã‚‰ã«ä¸‹ãƒ»å³ã«ãƒ–ãƒ«ãƒ¼ãƒ™ãƒªãƒ¼ -->
<img
  src="../assets/blueberry.svg"
  alt="blueberry"
  class="absolute right-2 sm:right-6 top-[440px] w-10 sm:w-14 h-auto pointer-events-none select-none"
/>

<!-- â‘£ ã•ã‚‰ã«ä¸‹ãƒ»å·¦ã«ã©ã‚“ãã‚Šï¼ˆåŒé–“éš”ï¼‰ -->
<img
  src="../assets/Donguri.svg"
  alt="donguri"
  class="absolute left-2 sm:left-8 top-[620px] w-10 sm:w-14 h-auto pointer-events-none select-none"
/>


      
        </div>
      </div><!-- /#creditsScroll -->
    </div><!-- /#creditsScrollOuter -->
  </div><!-- /.relative -->
</div><!-- /#creditsOverlay -->

</div><!-- â˜… ã“ã‚Œï¼šã‚­ãƒ£ãƒ³ãƒã‚¹ã® outer relative ã‚’é–‰ã˜ã‚‹ -->


  

<!-- ãƒ«ãƒ¼ãƒ«ï¼ˆä¸­å¤®æƒãˆï¼‰ -->
<div class="w-full max-w-[768px] text-gray-200 text-sm mt-3 mb-20 px-1 leading-relaxed text-center no-select no-highlight">
  <p class="mb-1">
    ã²ã¾ã‚ã‚Š<img src="../assets/sunflower.svg" alt="sunflower" class="icon-inline">
    ã‚„ãƒ–ãƒ«ãƒ¼ãƒ™ãƒªãƒ¼<img src="../assets/blueberry.svg" alt="blueberry" class="icon-inline">
    ã‚’<br class="sm:hidden"/>é¿ã‘ãªãŒã‚‰ãƒã‚¤ã‚¹ã‚³ã‚¢ã‚’ç›®æŒ‡ãã†ï¼
  </p>
  <p>
    ãŸã¾ã«è½ã¡ã¦ã‚‹ã©ã‚“ãã‚Š<img src="../assets/Donguri.svg" alt="donguri" class="icon-inline">
    ã¯æ‹¾ã„ãŸã„ã‚€ã‚‹ã­
  </p>

    <!-- â–¼ ãƒãƒ¼ã‚¸ãƒ§ãƒ³è¡¨ç¤ºï¼ˆå³ä¸‹ã«ã¡ã‚‡ã“ã£ã¨ï¼‰ -->
  <p class="mt-2 text-[10px] text-gray-400 text-right pr-2 sm:text-xs">
    version <span id="versionLabel"></span>
  </p>


</div>

<!-- ã‚¸ãƒ£ãƒ³ãƒ—ãƒœã‚¿ãƒ³ -->
<div class="w-full max-w-[768px] flex justify-center p-4 fixed bottom-0 left-1/2 -translate-x-1/2 no-select no-highlight">
<button id="jumpButton" class="control-button w-full py-12 text-white font-bold rounded-lg shadow-lg text-2xl no-select" draggable="false">
  ã‚²ãƒ¼ãƒ ã‚¹ã‚¿ãƒ¼ãƒˆ
</button>

</div>

<script>

const SCORE_API_URL = 'https://script.google.com/macros/s/AKfycby2GHfn2Lq9iRqH45iOH8t1f9rM8e7Wm5AeUO92g8g35u7F7muzXokQoagjKaQrpg9ALw/exec';

async function sendScoreToServer(currentScore){
  try {
    // â˜…å‰å›ã®åå‰ã‚’ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã«ã™ã‚‹ï¼ˆãªã‘ã‚Œã°ç©ºæ¬„ï¼‰
    const prevName = localStorage.getItem('muruPlayerName') || '';

    // â˜…å¿…ãšä½•ã‹ã—ã‚‰å…¥åŠ›ã•ã›ã‚‹ãƒ«ãƒ¼ãƒ—
    let name = '';
    while (true) {
      const input = prompt(
        'ãƒ©ãƒ³ã‚­ãƒ³ã‚°ã«è¼‰ã›ã‚‹åå‰ã‚’å…¥ã‚Œã¦ã­ï¼ˆå¿…é ˆï¼‰',
        prevName
      );

      // ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã•ã‚ŒãŸã‚‰é€ä¿¡è‡ªä½“ã‚„ã‚ã‚‹
      if (input === null) {
        return;
      }

      name = input.trim();

      // ä½•ã‹å…¥ã£ã¦ãŸã‚‰OK
      if (name) break;

      alert('åå‰ã¯å¿…é ˆã‚€ã‚Šã‚…ï¼›ï¼›');
    }

    // ï¼ˆãŠå¥½ã¿ï¼‰é•·ã™ãã‚‹ã¨ã‚¢ãƒ¬ãªã‚“ã§ã¡ã‚‡ã„åˆ¶é™ã‹ã‘ã¦ã‚‚ã„ã„
    if (name.length > 16) {
      name = name.slice(0, 16);
      alert('åå‰é•·ã™ãã‚£ï¼å…ˆé ­16æ–‡å­—ã ã‘ä½¿ã†ã‚€ã‚‹ï¼');
    }

    localStorage.setItem('muruPlayerName', name);

    // â˜…é€ä¿¡ä¸­ã®è¦‹ãŸç›®
    if (sendScoreButton){
      sendScoreButton.disabled = true;
      sendScoreButton.textContent = 'é€ä¿¡ä¸­ã‚€ã‚‹â€¦';
      sendScoreButton.classList.remove('bg-blue-600', 'hover:bg-blue-700');
      sendScoreButton.classList.add('bg-blue-900', 'cursor-wait');
    }

    const params = new URLSearchParams({
      mode: 'post',
      name: name,
      score: String(currentScore),
      version: GAME_VERSION,
    });

    const res = await fetch(`${SCORE_API_URL}?${params.toString()}`, {
      method: 'GET',
    });

    const data = await res.json();
    if (!data || data.status !== 'ok') {
      throw new Error(data && data.message ? data.message : 'API status!=ok');
    }

    alert('ã‚¹ã‚³ã‚¢é€ä¿¡ã—ãŸã‚€ã‚‹ï¼');

    // â˜… é€ä¿¡å®Œäº† â†’ ãƒœã‚¿ãƒ³ã‚’é€æ˜åŒ–ï¼†ç„¡åŠ¹åŒ–
    sendScoreButton.textContent = "ã‚¹ã‚³ã‚¢é€ä¿¡æ¸ˆã¿";
    sendScoreButton.disabled = true;

    sendScoreButton.classList.remove(
      "bg-blue-600",
      "hover:bg-blue-700",
      "cursor-pointer"
    );

    sendScoreButton.classList.add(
      "bg-gray-500",
      "opacity-60",
      "cursor-not-allowed"
    );

  } catch (err) {
    console.error(err);
    alert('é€ä¿¡ã«å¤±æ•—ã—ãŸã‚€ã‚Šã‚…â€¦æ™‚é–“ã‚’ç½®ã„ã¦è©¦ã—ã¦ã¿ã¦ã»ã—ã„ã‚€ã‚‹ï¼');

    // â˜…å¤±æ•—ã—ãŸã‚‰ãƒœã‚¿ãƒ³å¾©æ´»ã•ã›ã‚‹
    if (sendScoreButton){
      sendScoreButton.disabled = false;
      sendScoreButton.textContent = 'ãƒ©ãƒ³ã‚­ãƒ³ã‚°ã«é€ä¿¡';
      sendScoreButton.classList.remove(
        'bg-blue-900',
        'cursor-wait',
        'bg-gray-500',
        'cursor-not-allowed'
      );
      sendScoreButton.classList.add('bg-blue-600', 'hover:bg-blue-700');
    }
  }
}






  
// ç”»åƒãƒ­ãƒ¼ãƒ€
function loadImg(src){ const img = new Image(); img.src = src; return img; }
const SPRITES = {
  blueberry: loadImg('../assets/blueberry.svg'),
  sunflower: loadImg('../assets/sunflower.svg'),
  donguri:   loadImg('../assets/Donguri.svg'),
  sunflower2: loadImg('../assets/sunflower2.png')
};

  
  // iOSã®é•·æŠ¼ã—é¸æŠãƒ»ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆãƒ¡ãƒ‹ãƒ¥ãƒ¼æŠ‘æ­¢ï¼ˆãƒœã‚¿ãƒ³æ“ä½œã¯ãã®ã¾ã¾ï¼‰
document.addEventListener('selectstart', e => e.preventDefault());
document.addEventListener('contextmenu', e => e.preventDefault(), { passive: false });


// â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜… ã‚²ãƒ¼ãƒ ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ï¼ˆã“ã“ã ã‘å¤‰ãˆãŸã‚‰OKï¼‰â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…
const GAME_VERSION = '2.0';

// â˜…â˜…â˜…â˜…â˜… ãƒ‡ãƒãƒƒã‚°æ©Ÿèƒ½ãƒã‚¹ã‚¿ãƒ¼ã‚¹ã‚¤ãƒƒãƒï¼ˆã“ã“ã ã‘ã„ã˜ã‚Œã°OKï¼‰ â˜…â˜…â˜…â˜…â˜…
// æœ¬ç•ªã§ã¯å…¨éƒ¨ false ã«ã™ã‚‹ or å¿…è¦ãªã‚‚ã®ã ã‘ true ã«ã™ã‚‹
const DEBUG_OPTIONS = {
  invincibleMode: true,  // ç„¡æ•µãƒ¢ãƒ¼ãƒ‰ï¼ˆ20å›ã‚¿ãƒƒãƒ—ã§ONï¼‰
  warpPC: true,          // ãƒãƒ¼ã‚ºä¸­ã®ã€Œ3 / 5ã€ã‚­ãƒ¼ã§ã‚¹ã‚³ã‚¢ãƒ¯ãƒ¼ãƒ—
  warpMobile: true       // ãƒãƒ¼ã‚ºä¸­ã®ã‚¹ã‚³ã‚¢ / ãƒã‚¤ã‚¹ã‚³ã‚¢é€£æ‰“ãƒ¯ãƒ¼ãƒ—
};


  
/* ===== åŸºæœ¬ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ— ===== */
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
const scoreEl = document.getElementById('score');
const highScoreEl = document.getElementById('highScore');
const gameOverScreen = document.getElementById('gameOverScreen');

const scoreLabel = document.getElementById('scoreLabel');

// â˜… ã‚¹ãƒãƒ›ç”¨ï¼šãƒãƒ¼ã‚ºä¸­ã«ã‚¹ã‚³ã‚¢/ãƒã‚¤ã‚¹ã‚³ã‚¢é€£æ‰“ã§ãƒ¯ãƒ¼ãƒ—
let warpTapCount300 = 0;
let warpTapCount500 = 0;
const WARP_TAPS_THRESHOLD = 5;        // 5é€£æ‰“ã§ç™ºå‹•
const WARP_TAP_WINDOW_MS = 1500;      // 1.5ç§’ä»¥å†…ã«5ã‚¿ãƒƒãƒ—

let warpTapTimer300 = null;
let warpTapTimer500 = null;

function tapWarp300(){
  warpTapCount300++;
  if (warpTapTimer300) clearTimeout(warpTapTimer300);
  warpTapTimer300 = setTimeout(() => {
    warpTapCount300 = 0;
    warpTapTimer300 = null;
  }, WARP_TAP_WINDOW_MS);

  if (warpTapCount300 >= WARP_TAPS_THRESHOLD){
    warpTapCount300 = 0;
    if (warpTapTimer300) clearTimeout(warpTapTimer300);
    warpTapTimer300 = null;
    warpToScoreBand(300);
    console.log('DEBUG: warp to score 300 band');
  }
}

function tapWarp500(){
  warpTapCount500++;
  if (warpTapTimer500) clearTimeout(warpTapTimer500);
  warpTapTimer500 = setTimeout(() => {
    warpTapCount500 = 0;
    warpTapTimer500 = null;
  }, WARP_TAP_WINDOW_MS);

  if (warpTapCount500 >= WARP_TAPS_THRESHOLD){
    warpTapCount500 = 0;
    if (warpTapTimer500) clearTimeout(warpTapTimer500);
    warpTapTimer500 = null;
    warpToScoreBand(500);
    console.log('DEBUG: warp to score 500 band');
  }
}

  
const highScoreBanner = document.getElementById('highScoreBanner');

// â˜… ãƒãƒ¼ã‚ºä¸­ã«ãƒ©ãƒ™ãƒ«ã‚’é€£æ‰“ â†’ ã‚¹ã‚³ã‚¢å¸¯ãƒ¯ãƒ¼ãƒ—ï¼ˆã‚¹ãƒãƒ›ç”¨ã®éš ã—æ“ä½œï¼‰
if (DEBUG_OPTIONS.warpMobile && scoreLabel) {
  scoreLabel.addEventListener('pointerdown', e => {
    if (!isPaused || !gameStarted || isGameOver) return;
    e.preventDefault();
    tapWarp300();
  });
}

if (DEBUG_OPTIONS.warpMobile && highScoreEl) {
  highScoreEl.addEventListener('pointerdown', e => {
    if (!isPaused || !gameStarted || isGameOver) return;
    e.preventDefault();
    tapWarp500();
  });
}




  
const finalScoreEl = document.getElementById('finalScore');

// const restartButton = document.getElementById('restartButton');

const shareButton = document.getElementById('shareButton');
const jumpButton = document.getElementById('jumpButton');
const pauseButton = document.getElementById('pauseButton');
const pauseOverlay = document.getElementById('pauseOverlay');  // â˜…ã“ã“è¿½åŠ 

const gameOverHighScoreLabel = document.getElementById('gameOverHighScoreLabel');

const startScreen = document.getElementById('startScreen');
// const startButton = document.getElementById('startButton'); â†å‰Šé™¤

const muteButton = document.getElementById('muteButton');
const creditsOverlay = document.getElementById('creditsOverlay');
const creditsButton = document.getElementById('creditsButton');
const creditsScroll = document.getElementById('creditsScroll');

const rankingOverlay      = document.getElementById('rankingOverlay');
const rankingContent      = document.getElementById('rankingContent');
const closeRankingButton  = document.getElementById('closeRankingButton');

// â˜… è¿½åŠ ï¼šãƒªã‚»ãƒƒãƒˆé–¢é€£
const resetConfirmOverlay = document.getElementById('resetConfirmOverlay');
const resetButton         = document.getElementById('resetButton');
const confirmResetButton  = document.getElementById('confirmResetButton');
const cancelResetButton   = document.getElementById('cancelResetButton');
  

const versionLabel = document.getElementById('versionLabel');
if (versionLabel) {
  versionLabel.textContent = `v${GAME_VERSION}`;
}


const sendScoreButton   = document.getElementById('sendScoreButton');
const sendStatusMessage = document.getElementById('sendStatusMessage');

const viewRankingButton = document.getElementById('viewRankingButton');

if (sendScoreButton){
  sendScoreButton.addEventListener('click', (e) => {
    e.preventDefault();
    sendScoreToServer(score);    // ä»Šã®ã‚¹ã‚³ã‚¢ã‚’é€ä¿¡
  });
}

if (viewRankingButton){
  viewRankingButton.addEventListener('click', (e) => {
    e.preventDefault();
    openRankingOverlay();
  });
}

if (closeRankingButton){
  closeRankingButton.addEventListener('click', (e) => {
    e.preventDefault();
    closeRankingOverlay();
  });
}


function escapeHtml(str){
  const map = {
    '&': '&amp;',
    '<': '&lt;',
    '>': '&gt;',
    '"': '&quot;',
    "'": '&#39;',
  };
  return String(str).replace(/[&<>"']/g, c => map[c]);
}


async function openRankingOverlay(){
  if (!rankingOverlay || !rankingContent) return;

  rankingOverlay.classList.remove('hidden');
  rankingOverlay.classList.add('flex');

 // â˜… ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³ã‚’ã€Œãƒ©ãƒ³ã‚­ãƒ³ã‚°ã‚’é–‰ã˜ã‚‹ã€ãƒ¢ãƒ¼ãƒ‰ã«
  updateJumpButton(JUMP_MODE.RANKING);
  
  rankingContent.innerHTML = '<p class="text-center text-sm">èª­ã¿è¾¼ã¿ä¸­ã‚€ã‚‹â€¦</p>';

  try {
    const res = await fetch(`${SCORE_API_URL}?mode=json`, { method: 'GET' });
    if (!res.ok) throw new Error('HTTP ' + res.status);

    const data = await res.json();
    const scores = data.scores || [];

    if (!scores.length){
      rankingContent.innerHTML =
        '<p class="text-center text-sm">ã¾ã è¨˜éŒ²ãŒãªã„ã‚€ã‚‹â€¦</p>';
      return;
    }

    rankingContent.innerHTML = scores.map(s => `
      <div class="flex items-center gap-2 border-b border-gray-700 py-1">
        <span class="w-8 text-left text-xs sm:text-sm">#${s.rank}</span>
        <span class="flex-1 text-left truncate text-xs sm:text-sm">
          ${escapeHtml(s.name)}
        </span>
        <span class="w-16 text-right font-mono text-sm sm:text-base">
          ${s.score}
        </span>
      </div>
    `).join('');
  } catch (err){
    console.error(err);
    rankingContent.innerHTML =
      '<p class="text-center text-sm text-red-300">ãƒ©ãƒ³ã‚­ãƒ³ã‚°ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ãŸã‚€ã‚‹â€¦</p>';
  }
}


function closeRankingOverlay(){
  if (!rankingOverlay) return;
  rankingOverlay.classList.add('hidden');
  rankingOverlay.classList.remove('flex');

  // çŠ¶æ…‹ã«å¿œã˜ã¦ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³ã‚’æˆ»ã™
  if (isGameOver){
    updateJumpButton(JUMP_MODE.RESTART);

    // â˜… ã¾ã ã‚¯ãƒ¼ãƒ«ã‚¿ã‚¤ãƒ ä¸­ãªã‚‰ã‚°ãƒ¬ãƒ¼ã®ã¾ã¾
    if (!canRestart){
      setRestartCooldownActive(true);
    }
  } else if (!gameStarted){
    updateJumpButton(JUMP_MODE.START);
  } else {
    updateJumpButton(JUMP_MODE.PLAY);
  }
}




function openResetOverlay(){
  if (!resetConfirmOverlay) return;
  resetConfirmOverlay.classList.remove('hidden');
  resetConfirmOverlay.classList.add('flex');
}

function closeResetOverlay(){
  if (!resetConfirmOverlay) return;
  resetConfirmOverlay.classList.add('hidden');
  resetConfirmOverlay.classList.remove('flex');
}

function closeResetOverlay(){
  if (!resetConfirmOverlay) return;
  resetConfirmOverlay.classList.add('hidden');
  resetConfirmOverlay.classList.remove('flex');
}

/* â˜… ãƒªã‚»ãƒƒãƒˆãƒœã‚¿ãƒ³ï¼ˆã‚¿ã‚¤ãƒˆãƒ«ç”»é¢ï¼‰ */
if (resetButton){
  resetButton.addEventListener('click', e => {
    e.preventDefault();
    // ã‚¿ã‚¤ãƒˆãƒ«ç”»é¢ã§ã ã‘æŠ¼ã›ã‚‹æƒ³å®šã‚„ã‘ã©ã€ã‚²ãƒ¼ãƒ ä¸­ã§ã‚‚æŒ™å‹•ã¯åŒã˜ã§OK
    openResetOverlay();
  });
}

// ã€Œã—ãªã„ã‚€ã‚‹ã€â†’ ä½•ã‚‚ã›ãšé–‰ã˜ã‚‹
if (cancelResetButton){
  cancelResetButton.addEventListener('click', e => {
    e.preventDefault();
    closeResetOverlay();
  });
}

// ã€Œæ¶ˆå»ã™ã‚‹ã€â†’ ãƒã‚¤ã‚¹ã‚³ã‚¢å‰Šé™¤ï¼‹ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
if (confirmResetButton){
  confirmResetButton.addEventListener('click', e => {
    e.preventDefault();

    // ãƒ­ãƒ¼ã‚«ãƒ«ä¿å­˜ã—ã¦ã‚‹ãƒã‚¤ã‚¹ã‚³ã‚¢ã‚’æ¶ˆã™
    highScore = 0;
    localStorage.removeItem('muruHighScore');

    if (highScoreEl){
      highScoreEl.textContent = 'ãƒã‚¤ã‚¹ã‚³ã‚¢: 0';
    }

    // ãƒã‚¤ã‚¹ã‚³ã‚¢æ¼”å‡ºç³»ã‚‚ãƒªã‚»ãƒƒãƒˆ
    isHighScoreRun = false;
    if (scoreLabel){
      scoreLabel.classList.remove('text-orange-400');
      scoreLabel.classList.add('text-blue-600');
    }
    if (highScoreBanner){
      highScoreBanner.classList.add('hidden');
    }

    // ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
    alert('ãƒã‚¤ã‚¹ã‚³ã‚¢ã‚’æ¶ˆå»ã—ãŸã‚€ã‚‹ï¼ã¾ãŸãŒã‚“ã°ã‚‹ã‚€ã‚‹');

    // ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤é–‰ã˜ã‚‹ï¼ˆã‚¿ã‚¤ãƒˆãƒ«ã«ã¯å…ƒã€…ã„ã‚‹çŠ¶æ…‹ï¼‰
    closeResetOverlay();
  });
}




  
/* â–¼ ãƒœãƒˆãƒ ã®ã‚¸ãƒ£ãƒ³ãƒ—ãƒœã‚¿ãƒ³ã®ãƒ¢ãƒ¼ãƒ‰ç®¡ç† */
const JUMP_MODE = {
  START: 'start',    // ã‚¿ã‚¤ãƒˆãƒ«ä¸­
  PLAY: 'play',      // ãƒ—ãƒ¬ã‚¤ä¸­
  RESTART: 'restart',  // ã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼å¾Œ
  CREDITS: 'credits',   // ã‚¯ãƒ¬ã‚¸ãƒƒãƒˆè¡¨ç¤ºä¸­ï¼ˆã‚¸ãƒ£ãƒ³ãƒ—ãƒœã‚¿ãƒ³ï¼ã¨ã˜ã‚‹ï¼‰
  RANKING: 'ranking'   // ãƒ©ãƒ³ã‚­ãƒ³ã‚°è¡¨ç¤ºä¸­ï¼ˆã¨ã˜ã‚‹ï¼‰
};

let jumpButtonMode = JUMP_MODE.START;

function updateJumpButton(mode){
  jumpButtonMode = mode;
  if (!jumpButton) return;

  // è‰²ç³»ã‚¯ãƒ©ã‚¹ã„ã£ãŸã‚“å…¨éƒ¨å¤–ã™
  jumpButton.classList.remove(
    'bg-blue-600',
    'bg-green-600',
    'bg-gray-700',
    'bg-gray-500',          // â˜… è¿½åŠ ï¼šãƒ­ãƒƒã‚¯ä¸­ã®è‰²
    'hover:bg-blue-700',
    'hover:bg-green-700',
    'hover:bg-gray-800',
    'opacity-60',           // â˜… è¿½åŠ ï¼šåŠé€æ˜
    'cursor-not-allowed'    // â˜… è¿½åŠ ï¼šç¦æ­¢ã‚«ãƒ¼ã‚½ãƒ«
  );

    switch(mode){
    case JUMP_MODE.START:
      jumpButton.textContent = 'ã‚²ãƒ¼ãƒ ã‚¹ã‚¿ãƒ¼ãƒˆ';
      jumpButton.classList.add('bg-green-600','hover:bg-green-700');
      break;

    case JUMP_MODE.PLAY:
      jumpButton.textContent = 'ã‚¸ãƒ£ãƒ³ãƒ—';
      jumpButton.classList.add('bg-blue-600','hover:bg-blue-700');
      break;

    case JUMP_MODE.RESTART:
      jumpButton.textContent = 'ãƒªã‚¹ã‚¿ãƒ¼ãƒˆ';
      jumpButton.classList.add('bg-green-600','hover:bg-green-700');
      break;

    case JUMP_MODE.CREDITS:
      jumpButton.textContent = 'ã¨ã˜ã‚‹';
      jumpButton.classList.add('bg-gray-700','hover:bg-gray-800');
      break;

    case JUMP_MODE.RANKING:          // â˜… è¿½åŠ 
      jumpButton.textContent = 'ã¨ã˜ã‚‹';
      jumpButton.classList.add('bg-gray-700','hover:bg-gray-800');
      break;
  }

}


// åˆæœŸçŠ¶æ…‹ã¯ã€Œã‚²ãƒ¼ãƒ ã‚¹ã‚¿ãƒ¼ãƒˆã€ï¼ˆç·‘ï¼‰
updateJumpButton(JUMP_MODE.START);



  

/* ===== Audioï¼ˆBGM/SEã€‚ãƒ•ã‚§ãƒ¼ãƒ‰ä¸€åˆ‡ãªã—ç‰ˆï¼‰ ===== */
let audioBooted = false;
let bgmAudio, bgm2Audio, endAudio, highEndAudio, highScoreSeAudio, creditsAudio, pickupPool = [];
let highScoreBgmTimeoutId = null;  // â˜… ãƒã‚¤ã‚¹ã‚³ã‚¢BGMã¸ã®åˆ‡æ›¿ã‚¿ã‚¤ãƒãƒ¼

let pickupIndex = 0; 
  
async function bootAudioOnce(){
  if (audioBooted) return;

  // iOSã®ã€Œä¸€å›ã‚¿ãƒƒãƒ—ã—ãªã„ã¨é³´ã‚‰ã¸ã‚“ã€å¯¾ç­–ã®ç„¡éŸ³ãƒ¯ãƒ³ã‚·ãƒ§ãƒƒãƒˆã ã‘æ®‹ã™
  try {
    const Ctx = window.AudioContext || window.webkitAudioContext;
    const ctx = new Ctx();
    const buf = ctx.createBuffer(1, Math.floor(ctx.sampleRate * 0.05), ctx.sampleRate);
    const src = ctx.createBufferSource();
    src.buffer = buf;
    src.connect(ctx.destination);
    src.start(0);
    setTimeout(() => { try { ctx.close(); } catch(_){} }, 80);
  } catch(_) {}

  // BGM / SE æœ¬ä½“
  bgmAudio  = new Audio('../assets/BGM.mp3');
  bgmAudio.loop       = true;
  bgmAudio.preload    = 'auto';
  bgmAudio.playsInline= true;
  bgmAudio.volume     = 0.5;

  bgm2Audio = new Audio('../assets/BGM2.mp3');
  bgm2Audio.loop        = true;
  bgm2Audio.preload     = 'auto';
  bgm2Audio.playsInline = true;
  bgm2Audio.volume      = 0.5;

  endAudio  = new Audio('../assets/END.mp3');
  endAudio.preload    = 'auto';
  endAudio.playsInline= true;
  endAudio.volume      = 0.4;

    // â˜…è¿½åŠ ï¼šãƒã‚¤ã‚¹ã‚³ã‚¢ç”¨ã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼SE
  highEndAudio = new Audio('../assets/HIGHEND.mp3');
  highEndAudio.preload    = 'auto';
  highEndAudio.playsInline= true;
  highEndAudio.volume      = 0.6;
  
  highScoreSeAudio = new Audio('../assets/SE.mp3');
  highScoreSeAudio.preload    = 'auto';
  highScoreSeAudio.playsInline= true;
  highScoreSeAudio.volume      = 0.5;

  creditsAudio = new Audio('../assets/CREDIT.mp3');
  creditsAudio.loop        = true;
  creditsAudio.preload     = 'auto';
  creditsAudio.playsInline = true;
  creditsAudio.volume      = 0.5;

  // ã©ã‚“ãã‚Š SE ãƒ—ãƒ¼ãƒ«
  for (let i = 0; i < 6; i++) {
    const a = new Audio('../assets/pick.mp3');
    a.preload    = 'auto';
    a.playsInline= true;
    pickupPool.push(a);
  }

  audioBooted = true;
}

document.addEventListener('touchstart', () => bootAudioOnce(), { once:true, passive:true });

let muted = false;

  
function applyMute(){
  const arr = [bgmAudio, bgm2Audio, endAudio, highEndAudio, highScoreSeAudio, creditsAudio, ...pickupPool];
  for (const a of arr){
    if (a) a.muted = muted;
  }
}



// â–¼ é€šå¸¸BGMï¼ˆæ­¢ã¾ã£ã¦ãŸã‚‰ã ã‘å†ç”Ÿï¼‰
function playMainBgm(){
  if (!bgmAudio) return;
  try { if (bgm2Audio) bgm2Audio.pause(); } catch(_) {}

  try {
    if (bgmAudio.paused) {
      bgmAudio.play().catch(() => {});
    }
  } catch(_) {}
}

// â–¼ ãƒã‚¤ã‚¹ã‚³ã‚¢ä¸­BGMï¼ˆæ­¢ã¾ã£ã¦ãŸã‚‰ã ã‘å†ç”Ÿï¼‰
function playHighScoreBgm(){
  if (!bgm2Audio) return;
  try { if (bgmAudio) bgmAudio.pause(); } catch(_) {}

  try {
    if (bgm2Audio.paused) {
      bgm2Audio.play().catch(() => {});
    }
  } catch(_) {}
}

// â–¼ å…±é€šã‚¹ã‚¿ãƒ¼ãƒˆ
async function startAudio(){
  await bootAudioOnce();

  if (isHighScoreRun){
    playHighScoreBgm();
  } else {
    playMainBgm();
  }

  applyMute();
}






  
// ã©ã‚“ãã‚ŠSEï¼ˆæ—¢å­˜ã®playPickup()ã¯ã“ã®ã¾ã¾ã§OKï¼‰
  function playPickup(){
  if(!pickupPool.length) return;
  const a = pickupPool[pickupIndex];
  pickupIndex = (pickupIndex + 1) % pickupPool.length;

  try{
    // iOSã§ç¨€ã«currentTimeãŒç„¡è¦–ã•ã‚Œã‚‹å¯¾ç­–ï¼šä¸€æ—¦åœæ­¢â†’å·»ãæˆ»ã—
    a.pause();
    a.currentTime = 0;
    const p = a.play();
    if(p && typeof p.catch === 'function'){ p.catch(()=>{}); }
  }catch(_){}
}


// ãƒŸãƒ¥ãƒ¼ãƒˆãƒœã‚¿ãƒ³
if (muteButton){
  const toggleMute = (e) => {
    e.preventDefault();
    e.stopPropagation();
    muted = !muted;
    applyMute();
    muteButton.textContent = muted ? 'ğŸ”‡' : 'ğŸ”Š';
  };
  muteButton.addEventListener('click', toggleMute);
}





  
// â–¼ ã‚¯ãƒ¬ã‚¸ãƒƒãƒˆå°‚ç”¨BGM
function playCreditsBgm(){
  try{ creditsAudio.currentTime = 0; creditsAudio.play(); }catch(_){}
}
function stopCreditsBgm(){
  try{ creditsAudio.pause(); creditsAudio.currentTime = 0; }catch(_){}
}


  

/* ===== ç”»é¢ã‚µã‚¤ã‚ºï¼ˆå›ºå®šãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆï¼‰ ===== */

const gameWidth  = 768;
const gameHeight = 384;  // â† ç¸¦å°‘ã—ä¼¸ã°ã™ï¼ˆ16:9 è¿‘ãï¼‰

canvas.width  = gameWidth;
canvas.height = gameHeight;


/* ===== ç©ºã®ãƒ†ãƒ¼ãƒï¼ˆæ›²ã‚¿ã‚¤ãƒŸãƒ³ã‚°é€£å‹• / ãƒ•ã‚§ãƒ¼ãƒ‰ï¼‰ ===== */
const THEMES={ morning:{top:[160,210,235],bottom:[247,250,252]}, evening:{top:[246,173,85],bottom:[253,230,138]}, night:{top:[45,55,90],bottom:[20,25,50]} };
let skyCurrent={ top:[...THEMES.morning.top], bottom:[...THEMES.morning.bottom] };
let skyTarget ={ top:[...THEMES.morning.top], bottom:[...THEMES.morning.bottom] };
const skyLerpSpeed=0.02;
let phaseName='morning';
function setBackgroundTheme(k){ const t=THEMES[k]||THEMES.morning; skyTarget={top:[...t.top],bottom:[...t.bottom]}; phaseName=k; }
function drawSky(df){
  const t=Math.min(1,skyLerpSpeed*df);
  for(let i=0;i<3;i++){ skyCurrent.top[i]+=(skyTarget.top[i]-skyCurrent.top[i])*t; skyCurrent.bottom[i]+=(skyTarget.bottom[i]-skyCurrent.bottom[i])*t; }
  const g=ctx.createLinearGradient(0,0,0,gameHeight);
  g.addColorStop(0,`rgb(${skyCurrent.top.map(x=>x|0).join(',')})`);
  g.addColorStop(0.8,`rgb(${skyCurrent.bottom.map(x=>x|0).join(',')})`);
  ctx.fillStyle=g; ctx.fillRect(0,0,gameWidth,gameHeight);
}



/* ===== æ›²ã‚¿ã‚¤ãƒŸãƒ³ã‚°ï¼ˆBGMã®é•·ã•ãƒ™ãƒ¼ã‚¹ã§æ™‚é–“ç®¡ç†ï¼‰ ===== */
// BGM.mp3 ã®é•·ã•ï¼š2:19.100 = 139.1 ç§’
const TRACK_LENGTH_S = 139.1;

// 1ãƒ«ãƒ¼ãƒ—ã®ä¸­ã§ã€Œå¤•ç„¼ã‘ã€ã«å…¥ã‚‹ã‚¿ã‚¤ãƒŸãƒ³ã‚°ï¼ˆå‰ã¨åŒã˜ 96ç§’ï¼‰
const EVENING_MARK_S = 96;

// ç¾åœ¨ BGM ãŒä½•å‘¨ç›®ã¾ã§é€²ã‚“ã æƒ³å®šã‹ï¼ˆ0,1,2,...ï¼‰
let skyLoopIndex = 0;
// ãã®ãƒ«ãƒ¼ãƒ—ã®ä¸­ã§ã€Œå¤•ç„¼ã‘ã€ã«ã‚‚ã†åˆ‡ã‚Šæ›¿ãˆæ¸ˆã¿ã‹ã©ã†ã‹
let skyEveningTriggered = false;

// ã‚²ãƒ¼ãƒ é–‹å§‹ãƒ»ãƒªã‚¹ã‚¿ãƒ¼ãƒˆæ™‚ã«å‘¼ã¶
function resetAudioSyncState(){
  skyLoopIndex        = 0;
  skyEveningTriggered = false;
  setBackgroundTheme('morning');
}

// çµŒéæ™‚é–“ï¼ˆtimeElapsedï¼‰ã‹ã‚‰ã€ŒBGM ã®ã©ã®ã‚ãŸã‚Šã‹ã€ã‚’é€†ç®—ã—ã¦ç©ºã‚’æ±ºã‚ã‚‹
function updateSkyByTimeline(){
  if (!gameStarted || isPaused || isGameOver) return;

  const tSec = timeElapsed / 1000;           // å…¨ä½“ã®çµŒéç§’æ•°
  const loopIndex = Math.floor(tSec / TRACK_LENGTH_S); // ä½•å‘¨ç›®ã‹
  const localSec  = tSec % TRACK_LENGTH_S;   // ãã®å‘¨ã®ä½•ç§’ç›®ã‹

  // â˜… ãƒ«ãƒ¼ãƒ—ãŒåˆ‡ã‚Šæ›¿ã‚ã£ãŸç¬é–“
  if (loopIndex !== skyLoopIndex){
    skyLoopIndex        = loopIndex;
    skyEveningTriggered = false;

    // ãƒ«ãƒ¼ãƒ—æ¯ã« æœ â†” å¤œ ã‚’ãƒˆã‚°ãƒ«
    // 0å‘¨ç›®: æœ, 1å‘¨ç›®: å¤œ, 2å‘¨ç›®: æœ, 3å‘¨ç›®: å¤œ, ...
    setBackgroundTheme((skyLoopIndex % 2 === 1) ? 'night' : 'morning');
  }

  // â˜… å„ãƒ«ãƒ¼ãƒ—ã® 96ç§’åœ°ç‚¹ã§ä¸€åº¦ã ã‘ã€Œå¤•ç„¼ã‘ã€ã«ã™ã‚‹
  if (!skyEveningTriggered && localSec >= EVENING_MARK_S){
    setBackgroundTheme('evening');
    skyEveningTriggered = true;
  }
}








  

/* ===== é›²ï¼ˆã‚¹ãƒ”ãƒ¼ãƒ‰å¢—ï¼‹ã‚²ãƒ¼ãƒ é€Ÿåº¦é€£å‹•ï¼‰ ===== */
let clouds = Array.from({length:6},()=>({
  x: Math.random()*gameWidth,
  y: 30 + Math.random()*100,
  base: 0.35 + Math.random()*0.35,
  size: 70 + Math.random()*70
}));

  
function drawClouds(df){
  // æ˜¼ãƒ»å¤•ãƒ»å¤œãã‚Œãã‚Œã§é›²ã®é€æ˜åº¦ã‚’å¤‰ãˆã‚‹
  let alpha;
  if (phaseName === 'night') {
    alpha = 0.03; // â† å¤œã¯ã‚ã£ã¡ã‚ƒè–„ãï¼ˆã»ã¼é€ã‘ã‚‹ï¼‰
  } else if (phaseName === 'evening') {
    alpha = 0.25; // â† å¤•æ–¹ã¯å°‘ã—ã‚ªãƒ¬ãƒ³ã‚¸ç©ºæ°—æ„Ÿ
  } else {
    alpha = 0.42; // â† æ˜¼é–“ã¯é€šå¸¸
  }

  ctx.fillStyle = `rgba(255,255,255,${alpha})`;

  const speedBoost = 1 + (gameSpeed / 10);
  for (const c of clouds) {
    const v = c.base * speedBoost;
    c.x -= v * df;
    if (c.x < -220) {
      c.x = gameWidth + 120;
      c.y = 30 + Math.random() * 100;
    }

    ctx.beginPath();
    ctx.ellipse(c.x, c.y, c.size, c.size * 0.55, 0, 0, Math.PI * 2);
    ctx.fill();

    ctx.beginPath();
    ctx.ellipse(c.x + c.size * 0.6, c.y + 10, c.size * 0.9, c.size * 0.48, 0, 0, Math.PI * 2);
    ctx.fill();
  }
}



  
/* ===== æ˜Ÿç©ºï¼ˆå¤œã ã‘ãƒ•ã‚§ãƒ¼ãƒ‰è¡¨ç¤ºãƒ»ã‚†ã£ãã‚Šè¦–å·®ãƒ»ãŸã¾ã«æµã‚Œæ˜Ÿï¼‰ ===== */
// ç”»é¢å¹…ã«å¯¾ã—ã¦æ§ãˆã‚ã€‚768pxãªã‚‰ ~75å€‹å‰å¾Œ
const STAR_COUNT = Math.max(40, Math.round(gameWidth * 0.10));

let stars = [];
let starAlpha = 0;                 // å¤œã¸ãƒ•ã‚§ãƒ¼ãƒ‰ã‚¤ãƒ³ï¼æœå¤•ã¸ãƒ•ã‚§ãƒ¼ãƒ‰ã‚¢ã‚¦ãƒˆ
const STAR_LERP = 0.03;            // ãƒ•ã‚§ãƒ¼ãƒ‰ã®ãªã‚ã‚‰ã‹ã•
let shooting = null;

// æ˜Ÿã¯ã‚²ãƒ¼ãƒ é€Ÿåº¦ã¨åˆ‡ã‚Šé›¢ã—ã€ä¸€å®šã®è¶…ä½é€Ÿãƒ‰ãƒªãƒ•ãƒˆã«ã™ã‚‹ï¼ˆé›ªã£ã½ã•é˜²æ­¢ï¼‰
const STAR_DRIFT_BASE = 0.12;      // 60fpsæ›ç®—ã ã¨ 0.12px/ãƒ•ãƒ¬ãƒ¼ãƒ ï¼ˆã‹ãªã‚Šã‚†ã£ãã‚Šï¼‰

function initStars(){
  stars = Array.from({length: STAR_COUNT}, () => ({
    x: Math.random()*gameWidth,
    // åœ°å¹³ç·šã‚ˆã‚Šä¸Šã ã‘ï¼†ä¸Šç©ºå´ã‚’å°‘ã—åšã‚ã«
    y: Math.random()*(groundY - 60),
    // å°ã•ã‚ã§å¤§åŠã‚’0.4ã€œ1.2pxã«æŠ‘ãˆã‚‹
    r: 0.4 + Math.random()*0.8,
    // ç¬ãã¯ã‹ãªã‚Šã‚†ã£ãã‚Š
    tw: Math.random()*Math.PI*2,
    twSpeed: 0.005 + Math.random()*0.007,   // 0.005ã€œ0.012
    // è¦–å·®ã¯æ¥µå°ï¼šè¿‘æ™¯ã§ã‚‚é€Ÿãè¦‹ãˆãªã„ãƒ¬ãƒ³ã‚¸ã«å›ºå®š
    parallax: 0.02 + Math.random()*0.06     // 0.02ã€œ0.08
  }));
}

// å¤œã ã‘ã€ãŸã¾ã«æµã‚Œæ˜Ÿ
function maybeSpawnShootingStar(){
  if (shooting || phaseName !== 'night') return;
  // ã ã„ãŸã„15ã€œ25ç§’ã«1å›ãã‚‰ã„ã®ä½“æ„Ÿï¼ˆæ§ãˆã‚ï¼‰
  if (Math.random() < 0.0025) {
    shooting = {
      x: Math.random() * (gameWidth * 0.6) + gameWidth * 0.2,
      y: 30 + Math.random() * (groundY * 0.35),
      vx: -(3 + Math.random()*2),
      vy:  1 + Math.random()*1.2,
      life: 60 + Math.random()*30,   // ãƒ•ãƒ¬ãƒ¼ãƒ å¯¿å‘½
      len: 40 + Math.random()*30
    };
  }
}

function drawStars(df){
  // å¤œã ã‘ã‚¿ãƒ¼ã‚²ãƒƒãƒˆ1ã€ãã‚Œä»¥å¤–0ã¸ãƒ•ã‚§ãƒ¼ãƒ‰
  const target = (phaseName === 'night') ? 1 : 0;
  starAlpha += (target - starAlpha) * (STAR_LERP * df);

  if (starAlpha <= 0.01 && phaseName !== 'night') return; // ã»ã¼è¦‹ãˆãªã„ãªã‚‰ã‚¹ã‚­ãƒƒãƒ—

  // ä¸€å®šã®ã”ãä½é€Ÿãƒ‰ãƒªãƒ•ãƒˆï¼‹æ¥µå°è¦–å·®ï¼ˆã‚²ãƒ¼ãƒ é€Ÿåº¦ã¨ã¯ç„¡é–¢ä¿‚ï¼‰
  for (const s of stars) {
    const drift = (STAR_DRIFT_BASE + s.parallax) * df; // å¸¸ã«ã‚†ã£ãã‚Šå·¦ã¸
    s.x -= drift;
    if (s.x < -3) { s.x = gameWidth + 3; s.y = Math.random()*(groundY - 60); }

    // ã‚†ã£ãã‚Šç¬ã
    s.tw += s.twSpeed * df;
    const twinkle = 0.75 + 0.25 * Math.sin(s.tw); // 0.5ã€œ1.0ãã‚‰ã„ã®æŸ”ã‚‰ã‹ã„æºã‚Œ
    const a = Math.max(0, Math.min(1, starAlpha * twinkle));

    ctx.fillStyle = `rgba(255,255,255,${a})`;
    ctx.beginPath(); ctx.arc(s.x, s.y, s.r, 0, Math.PI*2); ctx.fill();
  }

  // æµã‚Œæ˜Ÿï¼ˆæ—¢å­˜ã®è¦‹ãŸç›®ã‚’ç¶­æŒï¼‰
  maybeSpawnShootingStar();
  if (shooting) {
    const a = 0.75 * starAlpha;
    const tailX = shooting.x + shooting.len * 0.8;
    const tailY = shooting.y - shooting.len * 0.4;

    ctx.fillStyle = `rgba(255,255,255,${a})`;
    ctx.beginPath(); ctx.arc(shooting.x, shooting.y, 1.6, 0, Math.PI*2); ctx.fill();

    const grad = ctx.createLinearGradient(shooting.x, shooting.y, tailX, tailY);
    grad.addColorStop(0, `rgba(255,255,255,${a})`);
    grad.addColorStop(1, `rgba(255,255,255,0)`);
    ctx.strokeStyle = grad;
    ctx.lineWidth = 2;
    ctx.beginPath(); ctx.moveTo(shooting.x, shooting.y); ctx.lineTo(tailX, tailY); ctx.stroke();

    // æµã‚Œæ˜Ÿã ã‘ã¯å°‘ã—é€Ÿã„æ„Ÿã˜ã®ã¾ã¾ï¼ˆã‚²ãƒ¼ãƒ é€Ÿåº¦ã¨ã‚‚ç‹¬ç«‹ï¼‰
    shooting.x += shooting.vx * df;
    shooting.y += shooting.vy * df;
    shooting.life -= df;
    if (shooting.life <= 0 || shooting.x < -60 || shooting.y > groundY - 10) shooting = null;
  }
}




  
/* ===== åœ°é¢ï¼ˆè‰²å‘³èª¿æ•´ï¼‹é€Ÿåº¦ä¸€è‡´ï¼‰ ===== */
const groundY = gameHeight - 50;
function drawGround(){ ctx.fillStyle='#8B5A2B'; ctx.fillRect(0,groundY,gameWidth,50); }
initStars(); 

let groundGrains = [];   // ç´°ã‹ã„ç ‚
let groundPebbles = [];  // å°çŸ³
let groundStreaks = [];  // åœ°è¡¨ã®æ¨ªç·š

function initGroundDetails(){
  const grainsN  = Math.floor(gameWidth * 0.38);
  const pebblesN = Math.floor(gameWidth * 0.08);
  const streaksN = Math.floor(gameWidth * 0.05);

  // åºŠè‰²å¯„ã›ï¼ˆ#8B5A2B ä»˜è¿‘ï¼‰
  groundGrains = Array.from({length:grainsN},()=>({
    x: Math.random()*gameWidth,
    y: groundY + 8 + Math.random()*38,
    r: 0.8 + Math.random()*1.4,
    shadeR: 139 + Math.floor(Math.random()*8),   // 139ã€œ146
    shadeG: 90  + Math.floor(Math.random()*6),   // 90ã€œ95
    shadeB: 43  + Math.floor(Math.random()*6)    // 43ã€œ49
  }));
  groundPebbles = Array.from({length:pebblesN},()=>({
    x: Math.random()*gameWidth,
    y: groundY + 10 + Math.random()*36,
    w: 2 + Math.random()*3,
    h: 1 + Math.random()*2,
    shadeR: 133 + Math.floor(Math.random()*10),  // å°‘ã—æš—ã‚
    shadeG: 84  + Math.floor(Math.random()*10),
    shadeB: 40  + Math.floor(Math.random()*10)
  }));
  groundStreaks = Array.from({length:streaksN},()=>({
    x: Math.random()*gameWidth,
    y: groundY + 6 + Math.random()*10,
    len: 8 + Math.random()*18,
    shadeR: 130 + Math.floor(Math.random()*8),
    shadeG: 82  + Math.floor(Math.random()*8),
    shadeB: 38  + Math.floor(Math.random()*8)
  }));
}
initGroundDetails();

/* â˜… åœ°é¢ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«é€Ÿåº¦ï¼éšœå®³ç‰©ï¼ˆ= gameSpeedï¼‰ã«å®Œå…¨ä¸€è‡´ã•ã›ã‚‹ */
function drawGroundDetails(df){
  const v = gameSpeed * df; // â† çµ±ä¸€

  // ç ‚
  for(const g of groundGrains){
    g.x -= v;
    if(g.x < -2){ g.x = gameWidth + Math.random()*40; g.y = groundY + 8 + Math.random()*38; }
    ctx.fillStyle = `rgb(${g.shadeR}, ${g.shadeG}, ${g.shadeB})`;
    ctx.beginPath(); ctx.arc(g.x, g.y, g.r, 0, Math.PI*2); ctx.fill();
  }

  // å°çŸ³
  for(const p of groundPebbles){
    p.x -= v;
    if(p.x < -3){ p.x = gameWidth + Math.random()*60; p.y = groundY + 10 + Math.random()*36; }
    ctx.fillStyle = `rgb(${p.shadeR}, ${p.shadeG}, ${p.shadeB})`;
    ctx.fillRect(p.x, p.y, p.w, p.h);
  }

  // ã‚¹ãƒˆãƒªãƒ¼ã‚¯
  for(const s of groundStreaks){
    s.x -= v;
    if(s.x < -s.len){ s.x = gameWidth + Math.random()*80; s.y = groundY + 6 + Math.random()*10; }
    ctx.strokeStyle = `rgba(${s.shadeR}, ${s.shadeG}, ${s.shadeB}, 0.55)`;
    ctx.lineWidth = 1;
    ctx.beginPath(); ctx.moveTo(s.x, s.y); ctx.lineTo(s.x + s.len, s.y); ctx.stroke();
  }
}


/* ===== ã‚²ãƒ¼ãƒ æœ¬ä½“ ===== */
let score=0, highScore=parseInt(localStorage.getItem('muruHighScore')||'0',10); highScoreEl.textContent=`ãƒã‚¤ã‚¹ã‚³ã‚¢: ${highScore}`;
let gameSpeed=5, baseGameSpeed=5, gameSpeedAcceleration=0.05;
const GAME_SPEED_MAX=13;

let timeElapsed=0, obstacles=[], frame=0, spawnTimer=0;
const minSpawnIntervalBase=105, maxSpawnIntervalBase=155, spawnIntervalReductionPerSec=4;
const EARLY_EASE_MS=15000, EARLY_EASE_START_MULT=1.15;
  
function currentOnscreenLimit(ms){
  if(ms < 45000)  return 2; // ã€œ45s
  if(ms < 120000) return 3; // 45sã€œ2åˆ†
  return 4;                 // 2åˆ†ã€œ
}


let isGameOver=false, isPaused=false, gameStarted=false, lastTime=0;
let isDebug=false, debugTapCount=0; const DEBUG_TAPS_TO_ENABLE=20;
let nextSpawnInterval=90;
let isHighScoreRun = false;

// â˜… ã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼ç›´å¾Œã¯ãƒªã‚¹ã‚¿ãƒ¼ãƒˆã‚’å°‘ã—ã ã‘ãƒ­ãƒƒã‚¯ã™ã‚‹
let canRestart = false;
const RESTART_DELAY_MS = 1500; // â† å¥½ãã«èª¿æ•´ï¼ˆãƒŸãƒªç§’ï¼‰
  
// â˜… ãƒªã‚¹ã‚¿ãƒ¼ãƒˆãƒœã‚¿ãƒ³ã®è¦‹ãŸç›®ã‚’ã€Œãƒ­ãƒƒã‚¯ä¸­/è§£æ”¾æ¸ˆã¿ã€ã§åˆ‡ã‚Šæ›¿ãˆã‚‹
function setRestartCooldownActive(active){
  if (!jumpButton) return;
  if (jumpButtonMode !== JUMP_MODE.RESTART) return;

  // ã„ã£ãŸã‚“ã‚°ãƒ¬ãƒ¼ç³»ã‚¯ãƒ©ã‚¹ã‚’æƒé™¤
  jumpButton.classList.remove('bg-gray-500', 'opacity-60', 'cursor-not-allowed');

  if (active){
    // â˜… ãƒ­ãƒƒã‚¯ä¸­ â†’ ã‚°ãƒ¬ãƒ¼ï¼†æŠ¼ã›ãªã•ãã†ã«
    jumpButton.classList.remove('bg-green-600','hover:bg-green-700');
    jumpButton.classList.add('bg-gray-500','opacity-60','cursor-not-allowed');
  } else {
    // â˜… è§£æ”¾æ¸ˆã¿ â†’ ã„ã¤ã‚‚ã®ç·‘ã«æˆ»ã™
    jumpButton.classList.add('bg-green-600','hover:bg-green-700');
  }
}




  
// â˜… ãƒã‚¤ã‚¹ã‚³ã‚¢çªå…¥ãƒ•ãƒ©ãƒƒã‚·ãƒ¥ç”¨
let flashTimer = 0;
const FLASH_DURATION = 18; // ã ã„ãŸã„ 18ãƒ•ãƒ¬ãƒ¼ãƒ  â‰’ 0.3ç§’


/* === ã©ã‚“ãã‚Šï¼ˆSVG/é€Ÿåº¦å›ºå®š/5ç§’Â±1ç§’ã”ã¨ã«æŠ½é¸30%ï¼‰ === */
class Acorn{
  constructor(type,x,y,size){ this.type=type; this.x=x; this.y=y; this.size=size; this.t=Math.random()*Math.PI*2; }
  update(d){
    const fixedSpeed=0.5*baseGameSpeed; // å¸¸ã«ãƒ™ãƒ¼ã‚¹ã®åŠåˆ†ï¼ˆåŠ é€Ÿã—ãªã„ï¼‰
    this.x -= fixedSpeed * d;
    if(this.type==='air'){ this.t+=0.05*d; this.y += Math.sin(this.t)*0.2*d; }
  }
  draw(){
    const img=SPRITES.donguri; if(img && img.complete){ const w=this.size,h=this.size; ctx.drawImage(img,this.x,this.y-h,w,h); }
  }
  getHitbox(){
      return {
      x: this.x - this.size * 0.05,
      y: this.y - this.size * 1.02,
      width:  this.size * 0.9,
      height: this.size * 1.02
      };
  }

}
let acorns = [];

 // â˜… ã©ã‚“ãã‚Šå–ã£ãŸã¨ãã«å‡ºã™ã€Œ+10ã€ã¿ãŸã„ãªãƒ•ã‚­ãƒ€ã‚·ç”¨
class FloatText {
  constructor(text, x, y) {
    this.text = text;
    this.x = x;
    this.y = y;
    this.vy = -0.6;   // ä¸Šã«ãµã‚ã£ã¨ä¸ŠãŒã‚‹é€Ÿã•
    this.life = 30;   // å¯¿å‘½ï¼ˆå¤§ãã„ã»ã©é•·ãæ®‹ã‚‹ï¼‰
  }
}

let floatTexts = [];
 

// â˜… ãƒŸãƒªç§’åŸºæº–ã‚¿ã‚¤ãƒï¼ˆç«¯æœ«å·®ãªã—ï¼‰
let acornSpawnTimerMs = 0;
function nextAcornIntervalMs(){ return 5000 + Math.random()*2000; } // 5ã€œ7ç§’ã«ä¸€åº¦ æŠ½é¸
let acornNextIntervalMs = nextAcornIntervalMs();

function maybeSpawnAcorn(){
  if(Math.random() >= 0.30) return; // 30%ã§å‡ºã™
  const x = gameWidth + 20;         // â˜… æœªå®šç¾©ãƒã‚°ä¿®æ­£
  const size = 56 + Math.floor(Math.random()*12); // ã¡ã‚‡ã„å¤§ãã‚
  if(Math.random()<0.5){
    const y=groundY-6; acorns.push(new Acorn('ground',x,y,size));
  }else{
    const minY=groundY-160, maxY=groundY-60; const y=Math.floor(minY+Math.random()*(maxY-minY));
    acorns.push(new Acorn('air',x,y,size));
  }
}
function spawnAcornMs(deltaMs){
  acornSpawnTimerMs += deltaMs;
  if(acornSpawnTimerMs < acornNextIntervalMs) return;
  acornSpawnTimerMs = 0;
  acornNextIntervalMs = nextAcornIntervalMs();
  maybeSpawnAcorn();
}

function updateAcorns(d){
  for(let i=acorns.length-1;i>=0;i--){ acorns[i].update(d); acorns[i].draw(); if(acorns[i].x<-50) acorns.splice(i,1); }
}

  
function tryCollectAcorns(){
  const p={x:player.x,y:player.y,width:player.width*0.6,height:player.height*0.7};
  for(let i=acorns.length-1;i>=0;i--){
    const a=acorns[i], h=a.getHitbox();
    if(p.x<h.x+h.width && p.x+p.width>h.x && p.y<h.y+h.height && p.y+p.height>h.y){

      // â˜… é€šå¸¸ï¼š+10 / ãƒ‡ãƒãƒƒã‚°ä¸­ï¼š+200
      const gained = isDebug ? 200 : 10;
      score += gained;

      // â˜… ã“ã“ã§ã€Œ+10ã€(or +200) ãƒ•ã‚­ãƒ€ã‚·è¿½åŠ 
      floatTexts.push(
        new FloatText(
          `+${gained}`,
          a.x + a.size * 0.5,     // ã©ã‚“ãã‚Šã®çœŸã‚“ä¸­ã‚ãŸã‚Š
          a.y - a.size * 0.4      // å°‘ã—ä¸Š
        )
      );

      acorns.splice(i,1);
      playPickup();
    }
  }
}



/* ===== ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ ===== */
function clamp01(v){ return Math.max(0,Math.min(1,v)); }
function getEarlyEaseMultiplier(ms){ const t=clamp01(ms/EARLY_EASE_MS); return EARLY_EASE_START_MULT + (1.0-EARLY_EASE_START_MULT)*t; }
function getMinPixelGap(ms){ const t=clamp01(ms/EARLY_EASE_MS); const s=Math.round(gameWidth*0.42), e=Math.round(gameWidth*0.32); return Math.round(s+(e-s)*t); }
function enableDebugMode(){
  // â˜… ç„¡åŠ¹åŒ–ã•ã‚Œã¦ãŸã‚‰ä½•ã‚‚ã—ãªã„
  if (!DEBUG_OPTIONS.invincibleMode) return;

  if(isDebug) return;
  isDebug=true;
  const b=document.createElement('span');
  b.id='debugBadge';
  b.textContent='DEBUG';
  b.className='px-2 py-1 bg-pink-600 text-white text-xs font-bold rounded shadow-sm ml-1';
  highScoreEl.parentElement.appendChild(b);
}

function resetDebugTapCounter(){ debugTapCount=0; }

  
function startHighScoreRun(){
  if (isHighScoreRun) return;
  isHighScoreRun = true;

  // è¦‹ãŸç›®å¤‰æ›´
  if (scoreLabel){
    scoreLabel.classList.remove('text-blue-600');
    scoreLabel.classList.add('text-orange-400');
  }
  if (highScoreBanner){
    highScoreBanner.classList.remove('hidden');
  }
  flashTimer = FLASH_DURATION;

  // SE
  try{
    highScoreSeAudio.currentTime = 0;
    highScoreSeAudio.play();
  }catch(_){}

  // ã„ã£ãŸã‚“ BGM1/BGM2 ã‚’æ­¢ã‚ã‚‹
  try{
    if (bgmAudio){
      bgmAudio.pause();
      bgmAudio.currentTime = 0;
      bgmAudio.volume = 0.5;
    }
    if (bgm2Audio){
      bgm2Audio.pause();
      bgm2Audio.currentTime = 0;
      bgm2Audio.volume = 0.5;
    }
  }catch(_){}

  // æ—¢å­˜ã®ãƒ‡ã‚£ãƒ¬ã‚¤ã‚¿ã‚¤ãƒãƒ¼ãŒã‚ã‚Œã°ã‚­ãƒ£ãƒ³ã‚»ãƒ«
  if (highScoreBgmTimeoutId !== null){
    clearTimeout(highScoreBgmTimeoutId);
    highScoreBgmTimeoutId = null;
  }

  // â˜… 1ç§’å¾…ã£ã¦ã‹ã‚‰ BGM2 å†ç”Ÿï¼ˆãŸã ã—ã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼ã—ã¦ãŸã‚‰ä½•ã‚‚ã—ãªã„ï¼‰
  highScoreBgmTimeoutId = setTimeout(() => {
    highScoreBgmTimeoutId = null;
    if (isGameOver) return;   // â† ã“ã“å¤§äº‹

    playHighScoreBgm();
    applyMute();
  }, 1000);

  applyMute();
}



  



/* ===== ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ ===== */
const player = {
  x: 50,
  y: groundY - 50,
  width: 50,
  height: 50,
  dy: 0,
  gravity: 0.8,
  jumpForce: 15,
  isGrounded: true,
  jumpsRemaining: 2,
  isJumping: false,
  image: new Image(),
  imageLoaded: false,

  // â˜… ã·ã«ã‚‡ã‚“ç”¨
  scaleX: 1,
  scaleY: 1,
  squashTimer: 0       // ä¸€ç¬ã ã‘å¼·ãå¤‰å½¢ã•ã›ã‚‹ã‚¿ã‚¤ãƒãƒ¼
};

player.image.src='../assets/Muru.png';
player.image.onload=()=>{ player.imageLoaded=true; player.width=(player.image.width/player.image.height)*player.height; };

function drawPlayer() {
  const cx = player.x + player.width / 2;
  const cy = player.y + player.height / 2;

  ctx.save();
  ctx.translate(cx, cy);
  ctx.scale(player.scaleX, player.scaleY);

  if (player.imageLoaded) {
    ctx.drawImage(
      player.image,
      -player.width / 2,
      -player.height / 2,
      player.width,
      player.height
    );
  } else {
    ctx.fillStyle = 'green';
    ctx.fillRect(
      -player.width / 2,
      -player.height / 2,
      player.width,
      player.height
    );
  }

  ctx.restore();
}

function updatePlayer(d) {
  // ç‰©ç†
  if (!player.isGrounded) {
    player.dy += player.gravity * d;
    player.y  += player.dy * d;
  }

  // ç€åœ°åˆ¤å®š
  if (player.y + player.height >= groundY) {
    if (!player.isGrounded) {
      // â˜… ç€åœ°ã®ã¨ãã¯ãƒ‰ãƒ³ãƒƒã¨ã¤ã¶ã‚Œã‚‹
    player.squashTimer = 20;   // æˆ»ã‚Šæ™‚é–“ã¡ã‚‡ã„é•·ã‚
    player.scaleX = 1.5;      // æ¨ªãã„ã£ã¨åºƒã’ã‚‹
    player.scaleY = 0.5;      // ç¸¦ã¯ã‚¬ãƒƒãƒ„ãƒªã¤ã¶ã™
    }

    player.y = groundY - player.height;
    player.dy = 0;
    player.isGrounded = true;
    player.jumpsRemaining = 2;
  } else {
    player.isGrounded = false;
  }

  // â˜… ã·ã«ã‚…ã‚“ã‚¢ãƒ‹ãƒ¡ï¼ˆã‚¹ã‚±ãƒ¼ãƒ«ã®è£œé–“ï¼‰
  if (player.squashTimer > 0) {
    player.squashTimer -= d;

    // å¼·ã‚ã«ã€Œå…ƒã®å½¢ã€ã«æˆ»ã™
    const k = 0.25; // â† æˆ»ã‚Šã‚’ã‚­ãƒ“ã‚­ãƒ“
    player.scaleX += (1 - player.scaleX) * k;
    player.scaleY += (1 - player.scaleY) * k;
  } else {
    // ãµã ã‚“ã¯ã€åœ°ä¸Šã¨ç©ºä¸­ã§ã¡ã‚‡ã£ã¨ã ã‘å½¢å¤‰ãˆã‚‹
    const targetX = player.isGrounded ? 1.0 : 0.9;  // ç©ºä¸­ã¯ã¡ã‚‡ã„ç´°ã‚
    const targetY = player.isGrounded ? 1.0 : 1.10; // ç©ºä¸­ã¯å°‘ã—ä¼¸ã³ã‚‹

    const k = 0.15;
    player.scaleX += (targetX - player.scaleX) * k;
    player.scaleY += (targetY - player.scaleY) * k;
  }
}



function playerJump() {
  if (isGameOver || isPaused || !gameStarted) return;
  startAudio();

  if (player.jumpsRemaining > 0) {
    player.dy = -player.jumpForce;
    player.isGrounded = false;
    player.isJumping = true;
    player.jumpsRemaining--;

    // â˜… ã‚¸ãƒ£ãƒ³ãƒ—ç›´å¾Œï¼šãã‚…ã£ã¨ç¸®ã‚“ã§ã‹ã‚‰ä¼¸ã³ã‚‹æ„Ÿã˜
    player.squashTimer = 14;  // â† ã¡ã‚‡ã„é•·ã‚
    player.scaleX = 0.72;     // â† æ¨ªã‚’ç´°ã
    player.scaleY = 1.30;     // â† ç¸¦ã‚’ã‚°ã‚¤ã£ã¨ä¼¸ã°ã™
  }
}


function stopJump(){ if(player.isJumping && player.dy<0){ player.dy=Math.max(player.dy,-5); } player.isJumping=false; }

/* ===== éšœå®³ç‰©ï¼ˆå…ƒã®ãƒ­ã‚¸ãƒƒã‚¯ç¶­æŒï¼‰ ===== */
class Obstacle{
  constructor(type,img,y,size){
    this.x=gameWidth; this.y=y; this.type=type; this.img=img; this.height=size;
    const iw=img.naturalWidth||1, ih=img.naturalHeight||1, aspect=iw/ih;
    this.width=this.height*aspect; this.passed=false;
  }
  draw(){ ctx.drawImage(this.img,this.x,this.y-this.height,this.width,this.height); }
  update(d){ this.x -= gameSpeed*d; }
  getHitbox(){ const shrink=this.type==='ground_large'?0.65:0.8; const w=this.width*shrink, h=this.height*shrink; return { x:this.x+(this.width-w)/2, y:(this.y-this.height)+(this.height-h)/2, width:w, height:h }; }
}

/* â˜… è¿½åŠ ï¼šå‹•ãã²ã¾ã‚ã‚Šå°‚ç”¨ã‚¯ãƒ©ã‚¹ */
class SpecialSunflower extends Obstacle{
  constructor(type,img,y,size){
    super(type,img,y,size);
    this.baseY = y;
    this.phase = Math.random()*Math.PI*2;
    this.hopAmp = size * 0.5;   // ã´ã‚‡ã‚“ã´ã‚‡ã‚“ã®é«˜ã•
    this.hopSpeed = 0.18;        // ã´ã‚‡ã‚“ã´ã‚‡ã‚“ã®é€Ÿã•
  }

  update(d){
    if(this.type === 'sun2_run'){
      // ã“ã£ã¡ã«å‘ã‹ã£ã¦èµ°ã£ã¦ãã‚‹æ„Ÿã˜ï¼šæ™®é€šã‚ˆã‚Šã¡ã‚‡ã„é€Ÿã„
      this.x -= gameSpeed * 1.4 * d;
    }else if(this.type === 'sun2_hop'){
      // ãã®å ´ã§æµã‚Œã¦ãã‚‹ï¼‹å°ã•ãã‚¸ãƒ£ãƒ³ãƒ—
      this.x -= gameSpeed * d;
      this.phase += this.hopSpeed * d;
      const offset = Math.abs(Math.sin(this.phase)) * this.hopAmp;
      this.y = this.baseY - offset;
    }else{
      // ä¸‡ãŒä¸€ä»–ã‚¿ã‚¤ãƒ—ã«ã‚‚ä½¿ã£ãŸã¨ãç”¨
      super.update(d);
    }
  }
}



  

const SCALE = 0.7;

function spawnObstacle(delta){
  spawnTimer += delta;

  let minSpawnInterval = Math.max(
    minSpawnIntervalBase - (timeElapsed/1000)*spawnIntervalReductionPerSec,
    40
  );
  let maxSpawnInterval = Math.max(
    maxSpawnIntervalBase - (timeElapsed/1000)*spawnIntervalReductionPerSec,
    70
  );

  const easeMul = getEarlyEaseMultiplier(timeElapsed);
  minSpawnInterval *= easeMul;
  maxSpawnInterval *= easeMul;

  function lateDensityMul(ms){
    if(ms < 60000)  return 1.0;  // ã€œ60s
    if(ms < 120000) return 0.85; // 1ã€œ2åˆ†
    return 0.72;                 // 2åˆ†ã€œ
  }
  const ld = lateDensityMul(timeElapsed);
  minSpawnInterval *= ld;
  maxSpawnInterval *= ld;

  if (spawnTimer < nextSpawnInterval) return;

  const onscreen = obstacles.filter(o => (o.x + o.width > 0) && (o.x < gameWidth)).length;
  const limit = currentOnscreenLimit(timeElapsed);
  if (onscreen >= limit) return;

  const last = obstacles.length ? obstacles[obstacles.length-1] : null;
  const minGapPx = getMinPixelGap(timeElapsed);
  if (last){
    const gapPx = gameWidth - (last.x + last.width);
    if (gapPx < minGapPx) return;
  }

  const rand = Math.random();

  if (rand < 0.4){
    // ãƒ–ãƒ«ãƒ¼ãƒ™ãƒªãƒ¼ï¼ˆç©ºä¸­ï¼‰
    const size = (40 + Math.random()*20) * SCALE;
    const yPos = Math.random() < 0.3
      ? groundY - 30
      : groundY - 70 - Math.random()*50;
    obstacles.push(new Obstacle('air', SPRITES.blueberry, yPos, size));
} else {
  // â˜… æ™®é€šã®ã²ã¾ã‚ã‚Š vs å‹•ãã²ã¾ã‚ã‚Š
  const canUseSpecial = (score >= 300) && SPRITES.sunflower2;
  const useSpecial = canUseSpecial && (Math.random() < 0.2); // 5å›ã«1å›ãã‚‰ã„

  if (useSpecial){
    // â˜… 500æœªæº€ â†’ ãœã‚“ã¶ã‚¸ãƒ£ãƒ³ãƒ—ã²ã¾ã‚ã‚Š
    // â˜… 500ä»¥ä¸Š â†’ 50%ã§é€Ÿã„ / 50%ã§ã‚¸ãƒ£ãƒ³ãƒ—
    const isRunner = (score >= 500) && (Math.random() < 0.5);
    const type = isRunner ? 'sun2_run' : 'sun2_hop';

    const baseSize = (70 + Math.random()*20) * SCALE;
    const size = isRunner ? baseSize * 1.5 : baseSize * 1.65;

    obstacles.push(new SpecialSunflower(type, SPRITES.sunflower2, groundY, size));
  } else {
    // â˜…ã“ã“ã¯ä»Šã¾ã§é€šã‚Šã®æ™®é€šã²ã¾ã‚ã‚Š
    if (score > 10 && Math.random() < 0.3){
      obstacles.push(
        new Obstacle('ground_large', SPRITES.sunflower, groundY, 120 * SCALE * 1.25)
      );
    } else {
      obstacles.push(
        new Obstacle('ground', SPRITES.sunflower, groundY, (60 + Math.random()*20) * SCALE)
      );
    }
  }
}


  nextSpawnInterval = minSpawnInterval + Math.random()*(maxSpawnInterval - minSpawnInterval);
  spawnTimer = 0;
}


function updateObstacles(d){
  for(let i = obstacles.length - 1; i >= 0; i--){
    obstacles[i].update(d);
    obstacles[i].draw();
    if(obstacles[i].x + obstacles[i].width < 0){
      obstacles.splice(i, 1);
    }
  }
}





// â˜… ãƒ‡ãƒãƒƒã‚°ç”¨ï¼šã‚¹ã‚³ã‚¢å¸¯ã«ãƒ¯ãƒ¼ãƒ—ã™ã‚‹
function warpToScoreBand(targetScore){
  // ã‚¹ã‚³ã‚¢ã‚’ä¸€æ°—ã«é£›ã°ã™
  score = targetScore;
  scoreEl.textContent = score;

  // ã–ã£ãã‚Šã€Œ1ç§’ã‚ãŸã‚Šã‚¹ã‚³ã‚¢ç´„6ã€ãã‚‰ã„ã§æ™‚é–“ã‚’é€†ç®—
  const approxSec = targetScore / 6; // 300 â†’ ç´„50ç§’ã€500 â†’ ç´„83ç§’
  timeElapsed = approxSec * 1000;

  // ã‚²ãƒ¼ãƒ ã‚¹ãƒ”ãƒ¼ãƒ‰ã‚‚ã€ãã®æ™‚é–“å¸¯ã«è¿‘ã„å€¤ã«åˆã‚ã›ã‚‹
  gameSpeed = Math.min(
    baseGameSpeed + approxSec * gameSpeedAcceleration,
    GAME_SPEED_MAX
  );

  // ç”»é¢ä¸Šã®éšœå®³ç‰©ãƒ»ã©ã‚“ãã‚Šãƒ»ãƒ•ã‚­ãƒ€ã‚·ã‚’ä¸€æ—¦ãƒªã‚»ãƒƒãƒˆ
  obstacles = [];
  acorns = [];
  floatTexts = [];

  // ã‚¹ãƒãƒ¼ãƒ³é–¢ä¿‚ãƒªã‚»ãƒƒãƒˆï¼ˆæ–°ã—ã„å¸¯ã®æ¡ä»¶ã§å‡ºç›´ã—ï¼‰
  spawnTimer = 0;
  nextSpawnInterval = minSpawnIntervalBase + Math.random() * (maxSpawnIntervalBase - minSpawnIntervalBase);

  // ã©ã‚“ãã‚Šã‚¿ã‚¤ãƒãƒ¼ã‚‚ãƒªã‚»ãƒƒãƒˆ
  acornSpawnTimerMs = 0;
  acornNextIntervalMs = nextAcornIntervalMs();
}

  

/* ===== å½“ãŸã‚Šåˆ¤å®š / ã‚¹ã‚³ã‚¢ / é€Ÿåº¦ ===== */
function checkCollision(){
  if(isDebug) return;
  const p={x:player.x,y:player.y,width:player.width*0.6,height:player.height*0.7};
  for(const o of obstacles){ const h=o.getHitbox(); if(p.x<h.x+h.width && p.x+p.width>h.x && p.y<h.y+h.height && p.y+p.height>h.y){ gameOver(); return; } }
}




  
function updateScore(){
  for(const o of obstacles){
    if(!o.passed && o.x+o.width < player.x){
      score++;
      o.passed = true;
    }
  }
  tryCollectAcorns();
  scoreEl.textContent = score;

  // â˜… ã“ã“ã§ã€Œãƒã‚¤ã‚¹ã‚³ã‚¢æ›´æ–°ä¸­ã€ã‚’æ¤œçŸ¥ï¼ˆåˆå› highScore=0 ã®ã¨ãã¯ã‚¹ãƒ«ãƒ¼ï¼‰
  if (!isHighScoreRun && highScore > 0 && score > highScore) {
    startHighScoreRun();
  }


  const tSec=timeElapsed/1000;
  gameSpeed=Math.min(baseGameSpeed + tSec*gameSpeedAcceleration, GAME_SPEED_MAX);
}
  

/* ===== çµ‚äº†å‡¦ç†ãªã© ===== */
function buildXIntentUrl(score){ const text=`ã‚€ã‚‹ã ã£ã—ã‚…ï¼ã‚¹ã‚³ã‚¢ã¯ã€Œ${score}ã€ã§ã—ãŸğŸŒ»\nhttps://t4l-ovo-t4l.github.io/murudash/`; return `https://x.com/intent/tweet?text=${encodeURIComponent(text)}`; }


  
function gameOver(){
  if (isGameOver) return;
  isGameOver = true;
  gameStarted = false;

  // â˜… ã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼ç”»é¢ã‚’é–‹ãã¨ãã«ã€é€ä¿¡ãƒœã‚¿ãƒ³ã‚’åˆæœŸçŠ¶æ…‹ã«æˆ»ã™
  sendScoreButton.disabled = false;
  sendScoreButton.textContent = "ãƒ©ãƒ³ã‚­ãƒ³ã‚°ã«é€ä¿¡";
  sendScoreButton.classList.remove(
    "bg-gray-500",
    "opacity-60",
    "cursor-not-allowed",
    "bg-blue-900",
    "cursor-wait"
  );
  sendScoreButton.classList.add("bg-blue-600", "hover:bg-blue-700");

  // â˜… ã¾ãšãƒœã‚¿ãƒ³ãƒ¢ãƒ¼ãƒ‰ã‚’ã€Œãƒªã‚¹ã‚¿ãƒ¼ãƒˆã€ã«ã—ã¦â€¦â€¦
  updateJumpButton(JUMP_MODE.RESTART);

  // â˜… ãƒªã‚¹ã‚¿ãƒ¼ãƒˆä¸€æ™‚ãƒ­ãƒƒã‚¯ & è¦‹ãŸç›®ã‚’ã‚°ãƒ¬ãƒ¼ã«
  canRestart = false;
  setRestartCooldownActive(true);  // â† ã‚°ãƒ¬ãƒ¼ï¼†æŠ¼ã›ãªã•ãã†ã«è¦‹ã›ã‚‹

  // ä¸€å®šæ™‚é–“å¾Œã«ãƒ­ãƒƒã‚¯è§£é™¤ï¼ˆã¾ã ã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼ãªã‚‰ç·‘ã«æˆ»ã™ï¼‰
  setTimeout(() => {
    canRestart = true;
    if (isGameOver && jumpButtonMode === JUMP_MODE.RESTART){
      setRestartCooldownActive(false);  // â† ç·‘ã«æˆ»ã™
    }
  }, RESTART_DELAY_MS);

  // â˜…ãƒã‚¤ã‚¹ã‚³ã‚¢é–¢ä¿‚ã®åˆ¤å®šã‚’å…ˆã«ã‚„ã‚‹
  const isNewHighScore       = score > highScore;
  const hadPreviousHighScore = highScore > 0;  // åˆå›ã ã‘ HIGHEND æŠœãç”¨

  // ã‚¿ã‚¤ãƒãƒ¼åœæ­¢ã¨ã‹
  if (highScoreBgmTimeoutId !== null){
    clearTimeout(highScoreBgmTimeoutId);
    highScoreBgmTimeoutId = null;
  }

  try {
    // BGM1 / BGM2 ã‚’ãã£ã¡ã‚Šæ­¢ã‚ã‚‹
    if (bgmAudio){
      bgmAudio.pause();
      bgmAudio.currentTime = 0;
      bgmAudio.volume = 0.5;
    }
    if (bgm2Audio){
      bgm2Audio.pause();
      bgm2Audio.currentTime = 0;
      bgm2Audio.volume = 0.5;
    }

    // â˜… åˆå›ï¼ˆhighScore=0ï¼‰ã®ãƒã‚¤ã‚¹ã‚³ã‚¢ã§ã¯ HIGHEND ã‚’é³´ã‚‰ã•ãªã„
    const useHighEnd = isNewHighScore && hadPreviousHighScore && highEndAudio;
    const se = useHighEnd ? highEndAudio : endAudio;

    if (se){
      se.currentTime = 0;
      se.play();
    }
  } catch(_) {}

  // â˜…ãƒã‚¤ã‚¹ã‚³ã‚¢ä¿å­˜ï¼ˆåˆå›ã‚‚å«ã‚ã¦æ™®é€šã«ä¿å­˜ï¼‰
  if (isNewHighScore){
    highScore = score;
    localStorage.setItem('muruHighScore', highScore);
    highScoreEl.textContent = `ãƒã‚¤ã‚¹ã‚³ã‚¢: ${highScore}`;
  }

  // ã‚¹ã‚³ã‚¢è¡¨ç¤ºã¨ã‹ãƒ©ãƒ™ãƒ«ã¾ã‚ã‚Š
  finalScoreEl.textContent = score;
  shareButton.href = buildXIntentUrl(score);

  if (gameOverHighScoreLabel){
    if (isHighScoreRun) gameOverHighScoreLabel.classList.remove('hidden');
    else gameOverHighScoreLabel.classList.add('hidden');
  }

  // ã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼ç”»é¢ã‚’å‡ºã™
  gameOverScreen.classList.remove('hidden');
  gameOverScreen.classList.add('flex');
}








  
function restartGame(){

  // â˜… ãƒªã‚¹ã‚¿ãƒ¼ãƒˆã—ãŸç¬é–“ã¯ã¾ãŸãƒ­ãƒƒã‚¯
  canRestart = false;
  
// â˜…ãƒªã‚¹ã‚¿ãƒ¼ãƒˆã—ãŸã‚‰ã‚¹ã‚³ã‚¢é€ä¿¡ãƒœã‚¿ãƒ³ã‚’åˆæœŸåŒ–
sendScoreButton.disabled = false;
sendScoreButton.textContent = "ãƒ©ãƒ³ã‚­ãƒ³ã‚°ã«é€ä¿¡";

sendScoreButton.classList.remove(
  "bg-gray-500",
  "opacity-60",
  "cursor-not-allowed"
);

sendScoreButton.classList.add(
  "bg-blue-600",
  "hover:bg-blue-700"
);



  // ã¾ãšä¸¡æ–¹ãã£ã¡ã‚Šæ­¢ã‚ã¦é ­å‡ºã— & ãƒœãƒªãƒ¥ãƒ¼ãƒ ãƒªã‚»ãƒƒãƒˆ
  if (bgm2Audio){
    try {
      bgm2Audio.pause();
      bgm2Audio.currentTime = 0;
      bgm2Audio.volume = 0.5;
    } catch(_) {}
  }
  if (bgmAudio){
    try {
      bgmAudio.pause();
      bgmAudio.currentTime = 0;
      bgmAudio.volume = 0.5;
    } catch(_) {}
  }

  // â˜… ã“ã“ã§ãƒã‚¤ã‚¹ã‚³ã‚¢ãƒ•ãƒ©ã‚°ã‚’å…ˆã«æŠ˜ã‚‹
  isHighScoreRun = false;

  // ãã®ã†ãˆã§é€šå¸¸BGMã‚¹ã‚¿ãƒ¼ãƒˆ
  startAudio();

  score=0; scoreEl.textContent=score; timeElapsed=0; gameSpeed=baseGameSpeed;
  obstacles=[]; acorns=[]; floatTexts=[]; frame=0; spawnTimer=0;

  initStars();
  starAlpha = 0;
  shooting = null;
  acornSpawnTimerMs = 0; acornNextIntervalMs = nextAcornIntervalMs();

  isGameOver=false; isPaused=false; gameStarted=true;
  player.y=groundY-player.height; player.dy=0; player.isGrounded=true; player.jumpsRemaining=2;
    // â˜… ã·ã«ã‚‡ã‚“ã‚¹ã‚±ãƒ¼ãƒ«ã‚‚ãƒªã‚»ãƒƒãƒˆ
  player.scaleX = 1;
  player.scaleY = 1;
  player.squashTimer = 0;
  gameOverScreen.classList.add('hidden'); gameOverScreen.classList.remove('flex'); pauseOverlay.classList.add('hidden');

  // ãƒ—ãƒ¬ã‚¤å†é–‹ãªã®ã§ã€Œã‚¸ãƒ£ãƒ³ãƒ—ã€ï¼ˆé’ï¼‰ã«æˆ»ã™
  updateJumpButton(JUMP_MODE.PLAY);


  
  // â†“ ã“ã“ä»¥é™ã® isHighScoreRun ã‚„ãƒãƒŠãƒ¼é–¢é€£ã®ãƒªã‚»ãƒƒãƒˆã¯ãã®ã¾ã¾ã§OKã‚„ã‘ã©
  //   ã‚‚ã† isHighScoreRun ã¯ false ã«ãªã£ã¦ã‚‹ã®ã§ç¾çŠ¶ã®ã¾ã¾ã§ã‚‚çŸ›ç›¾ã—ãªã„
  // isHighScoreRun = false; â† ã“ã“ã¯ã‚‚ã†ä¸è¦ãªã®ã§æ¶ˆã—ã¦ã‚ˆã—

  if(scoreLabel){
    scoreLabel.classList.remove('text-orange-400');
    scoreLabel.classList.add('text-blue-600');
  }
  if(highScoreBanner){
    highScoreBanner.classList.add('hidden');
  }
  if (gameOverHighScoreLabel){
    gameOverHighScoreLabel.classList.add('hidden');
  }


  applyMute();

  resetAudioSyncState(); isDebug=false; resetDebugTapCounter(); const dbg=document.getElementById('debugBadge'); if(dbg) dbg.remove();
  nextSpawnInterval = minSpawnIntervalBase + Math.random()*(maxSpawnIntervalBase - minSpawnIntervalBase);
  lastTime=performance.now(); requestAnimationFrame(gameLoop);
}


  
function togglePause(){
  if (isGameOver || !gameStarted) return;
  isPaused = !isPaused;

  if (isPaused){
    try{ bgmAudio.pause(); bgm2Audio.pause(); }catch(_){}
    pauseOverlay.classList.remove('hidden'); pauseOverlay.classList.add('flex');
  } else {
    try{
      if (isHighScoreRun){ if (bgm2Audio.paused) bgm2Audio.play(); }
      else { if (bgmAudio.paused) bgmAudio.play(); }
    }catch(_){}
    pauseOverlay.classList.add('hidden'); pauseOverlay.classList.remove('flex');
    lastTime = performance.now();
    requestAnimationFrame(gameLoop);
  }
}





function openCredits(e){
  if (e) e.preventDefault();

  // â˜…ã“ã“è¿½åŠ 
  bootAudioOnce();
  
  creditsOverlay.classList.remove('hidden');
  creditsOverlay.classList.add('flex');

  creditsScroll.classList.remove('credits-scroll');
  void creditsScroll.offsetWidth;          // ãƒªã‚¹ã‚¿ãƒ¼ãƒˆç”¨ãŠã¾ã˜ãªã„
  creditsScroll.classList.add('credits-scroll');

  try{ bgmAudio.pause(); bgm2Audio.pause(); }catch(_){}
  playCreditsBgm();

  // â˜… ã‚¯ãƒ¬ã‚¸ãƒƒãƒˆä¸­ã¯ã‚¸ãƒ£ãƒ³ãƒ—ãƒœã‚¿ãƒ³ï¼ã€Œã¨ã˜ã‚‹ã€
  updateJumpButton(JUMP_MODE.CREDITS);
}



function closeCredits(e){
  if (e) e.preventDefault();
  creditsOverlay.classList.add('hidden');
  creditsOverlay.classList.remove('flex');
  stopCreditsBgm();

  // â˜… ã‚¯ãƒ¬ã‚¸ãƒƒãƒˆé–‰ã˜ãŸã‚‰ã‚¸ãƒ£ãƒ³ãƒ—ãƒœã‚¿ãƒ³ã®å½¹å‰²ã‚’æˆ»ã™
  if (isGameOver){
    updateJumpButton(JUMP_MODE.RESTART);
  } else if (!gameStarted){
    updateJumpButton(JUMP_MODE.START);
  } else {
    updateJumpButton(JUMP_MODE.PLAY);
  }

  if (gameStarted && !isGameOver && !isPaused){
    try{
      if (isHighScoreRun){
        if (bgm2Audio.paused) bgm2Audio.play();
      } else {
        if (bgmAudio.paused) bgmAudio.play();
      }
    }catch(_){}
  }
}




  

// ã‚¿ã‚¤ãƒˆãƒ«ç”»é¢ã®ãƒœã‚¿ãƒ³
creditsButton.addEventListener('click', openCredits);
creditsButton.addEventListener('touchstart', openCredits, { passive: false });




  
/* ===== ãƒ«ãƒ¼ãƒ— ===== */
function gameLoop(ts){
  if (isGameOver || isPaused || !gameStarted) return;

  const dt = ts - lastTime; 
  lastTime = ts;

  // â˜… dfã‚¯ãƒ©ãƒ³ãƒ—ï¼šä¸€ç¬ã®ã‚¹ãƒ‘ã‚¤ã‚¯å¸åï¼ˆä½“æ„Ÿã‚«ã‚¯ã¤ãæ¿€æ¸›ï¼‰
  const df = Math.max(0.5, Math.min(1.8, dt / (1000/60)));

  timeElapsed += dt;

  
  // BGM.currentTime ã˜ã‚ƒãªãã¦ã€çµŒéæ™‚é–“ãƒ™ãƒ¼ã‚¹ã§ç©ºã‚’æ›´æ–°
  updateSkyByTimeline();

  // èƒŒæ™¯ï¼†é›²
  ctx.clearRect(0,0,gameWidth,gameHeight);
  drawSky(df); 
  drawStars(df); 
  drawClouds(df);

  // åœ°é¢ï¼‹æµã‚Œã‚‹ç ‚åˆ©ï¼ˆéšœå®³ç‰©ã¨åŒé€Ÿã§æµã™ï¼‰
  drawGround(); drawGroundDetails(df);

  // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ï¼éšœå®³ç‰©ï¼ã©ã‚“ãã‚Š
  updatePlayer(df); drawPlayer();
  spawnObstacle(df); updateObstacles(df);
  spawnAcornMs(dt); updateAcorns(df);

  // â˜… ã©ã‚“ãã‚Šã®ã€Œ+10ã€ã¿ãŸã„ãªãƒ•ã‚­ãƒ€ã‚·æç”»
  for (let i = floatTexts.length - 1; i >= 0; i--) {
    const ft = floatTexts[i];

    // ãµã‚ã£ã¨ä¸Šã«ç§»å‹•
    ft.y += ft.vy * df;
    ft.life -= df;

    // æ®‹ã‚Šå¯¿å‘½ã«å¿œã˜ã¦ã ã‚“ã ã‚“é€æ˜ã«
    const alpha = Math.max(0, Math.min(1, ft.life / 30));

    ctx.save();
    ctx.globalAlpha = alpha;
    ctx.font = 'bold 20px "Inter", system-ui, sans-serif';
    ctx.textAlign = 'center';
    ctx.textBaseline = 'bottom';

    // ã¡ã‚‡ã£ã¨ã‚¯ãƒªãƒ¼ãƒ è‰²ï¼‹é»’ãƒ•ãƒ
    ctx.strokeStyle = 'rgba(0,0,0,0.75)';
    ctx.lineWidth = 3;
    ctx.fillStyle = '#fff7aa';

    ctx.strokeText(ft.text, ft.x, ft.y);
    ctx.fillText(ft.text, ft.x, ft.y);
    ctx.restore();

    // å¯¿å‘½ãŒå°½ããŸã‚‰æ¶ˆã™
    if (ft.life <= 0) {
      floatTexts.splice(i, 1);
    }
  }

  
  // â˜… ãƒã‚¤ã‚¹ã‚³ã‚¢çªå…¥ãƒ•ãƒ©ãƒƒã‚·ãƒ¥
  if (flashTimer > 0) {
    const alpha = (flashTimer / FLASH_DURATION) * 0.85; // æœ€å¤§0.85ãã‚‰ã„ã¾ã§å…‰ã‚‹
    ctx.fillStyle = `rgba(255,255,255,${alpha})`;
    ctx.fillRect(0, 0, gameWidth, gameHeight);

    flashTimer -= df;          // æ™‚é–“çµŒéã§æ¸›ã‚‰ã™ï¼ˆdfã¯ã ã„ãŸã„1/ãƒ•ãƒ¬ãƒ¼ãƒ ï¼‰
    if (flashTimer < 0) flashTimer = 0;
  }

  
  checkCollision(); updateScore();

  frame++; requestAnimationFrame(gameLoop);
}

/* ===== å…¥åŠ› ===== */
window.addEventListener('keydown', e=>{
  if (e.repeat) return;

  // â˜… ãƒãƒ¼ã‚ºä¸­ã®æŒ™å‹•
  if (isPaused){
    // â‘  ç„¡æ•µãƒ¢ãƒ¼ãƒ‰ãƒˆãƒªã‚¬ãƒ¼ï¼ˆãƒ‡ãƒãƒƒã‚°æœ‰åŠ¹ã®ã¨ãã ã‘ï¼‰
    if (DEBUG_OPTIONS.invincibleMode &&
        (e.code === 'Space' || e.code === 'ArrowUp')){
      debugTapCount++;
      if (debugTapCount >= DEBUG_TAPS_TO_ENABLE){
        enableDebugMode();
        resetDebugTapCounter();
      }
      return;
    }

    // ã‚²ãƒ¼ãƒ å§‹ã¾ã£ã¦ãªã‘ã‚Œã°ä½•ã‚‚ã—ãªã„
    if (!gameStarted) return;

    // â‘¡ ãƒãƒ¼ã‚ºä¸­ã« 3 / 5 ã§ã‚¹ã‚³ã‚¢å¸¯ãƒ¯ãƒ¼ãƒ—ï¼ˆPCç”¨ï¼‰
    if (DEBUG_OPTIONS.warpPC && e.code === 'Digit3'){
      warpToScoreBand(300);
      console.log('DEBUG: warp to score 300 band');
      return;
    }
    if (DEBUG_OPTIONS.warpPC && e.code === 'Digit5'){
      warpToScoreBand(500);
      console.log('DEBUG: warp to score 500 band');
      return;
    }

    return;
  }

  // â˜… ãƒãƒ¼ã‚ºã—ã¦ãªã„é€šå¸¸æ™‚
  if (!gameStarted) return;

  if (e.code === 'Space' || e.code === 'ArrowUp') playerJump();
  if (e.code === 'KeyP') togglePause();
});


window.addEventListener('keyup', e=>{
  if (e.code === 'Space' || e.code === 'ArrowUp') stopJump();
});

jumpButton.addEventListener('pointerdown', e=>{
  e.preventDefault();

  // â˜… ãƒ©ãƒ³ã‚­ãƒ³ã‚°è¡¨ç¤ºä¸­ï¼šã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³ã§é–‰ã˜ã‚‹
  if (jumpButtonMode === JUMP_MODE.RANKING){
    closeRankingOverlay();
    return;
  }
  // â˜… ã‚¯ãƒ¬ã‚¸ãƒƒãƒˆè¡¨ç¤ºä¸­ï¼šã‚¸ãƒ£ãƒ³ãƒ—ãƒœã‚¿ãƒ³ï¼ã€Œã¨ã˜ã‚‹ã€
  if (jumpButtonMode === JUMP_MODE.CREDITS){
    closeCredits();
    return;
  }

  // â˜… ã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼ä¸­ãªã‚‰ãƒªã‚¹ã‚¿ãƒ¼ãƒˆ
  if (isGameOver) {

    // ã¾ã ã‚¯ãƒ¼ãƒ«ã‚¿ã‚¤ãƒ ä¸­ â†’ ä½•ã‚‚ã—ãªã„ï¼ˆèª¤ã‚¿ãƒƒãƒ—é˜²æ­¢ï¼‰
    if (!canRestart) return;

    restartGame();
    return;
  }

  // ã¾ã ã‚²ãƒ¼ãƒ ãŒå§‹ã¾ã£ã¦ã„ãªã„ï¼ã‚¿ã‚¤ãƒˆãƒ«ç”»é¢ä¸­ãªã‚‰ã€Œã‚¹ã‚¿ãƒ¼ãƒˆãƒœã‚¿ãƒ³ã€ã¨ã—ã¦å‹•ã
  if (!gameStarted) {
    handleGameStart();  // e ãªã—ã§å‘¼ã‚“ã§OKãªã‚ˆã†ã«ã—ã¦ã‚ã‚‹
    return;
  }

  // ãƒãƒ¼ã‚ºä¸­ï¼šç„¡æ•µãƒ¢ãƒ¼ãƒ‰ãƒˆãƒªã‚¬ãƒ¼ï¼ˆæœ‰åŠ¹ãªã¨ãã ã‘ï¼‰
  if (isPaused){
    if (DEBUG_OPTIONS.invincibleMode){
      debugTapCount++;
      if (debugTapCount >= DEBUG_TAPS_TO_ENABLE){
        enableDebugMode();
        resetDebugTapCounter();
      }
    }
    return;
  }


  // é€šå¸¸ãƒ—ãƒ¬ã‚¤ä¸­ã¯ã‚¸ãƒ£ãƒ³ãƒ—
  playerJump();
});



jumpButton.addEventListener('pointerup',   e=>{ e.preventDefault(); stopJump(); });
pauseButton.addEventListener('pointerdown', e => {
  e.preventDefault();
  togglePause();
});


function handleGameStart(e){

  
  if (e) e.preventDefault();   // â† e ãŒãªã„ã¨ãã‚‚è½ã¡ãªã„ã‚ˆã†ã«

  if(gameStarted) return;
  gameStarted = true;

  // ãƒ—ãƒ¬ã‚¤ä¸­ãƒ¢ãƒ¼ãƒ‰ï¼ˆé’ & ã‚¸ãƒ£ãƒ³ãƒ—ï¼‰
  updateJumpButton(JUMP_MODE.PLAY);


  startAudio();
  startScreen.classList.add('hidden');
  resetAudioSyncState();
  isDebug = false;
  resetDebugTapCounter();
  const dbg = document.getElementById('debugBadge');
  if(dbg) dbg.remove();

  lastTime = performance.now();
  requestAnimationFrame(gameLoop);
  nextSpawnInterval = minSpawnIntervalBase + Math.random()*(maxSpawnIntervalBase - minSpawnIntervalBase);
  spawnTimer = 0;
}

  

</script>
</body>
</html>
