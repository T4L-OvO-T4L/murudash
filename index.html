<!DOCTYPE html>
<html lang="ja">
<head>
<meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' https://cdn.tailwindcss.com 'unsafe-inline' 'unsafe-eval'; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com; font-src 'self' https://fonts.gstatic.com; img-src 'self' data:; media-src 'self';">
<meta name="referrer" content="strict-origin-when-cross-origin">
<link rel="preload" as="image" href="./assets/blueberry.svg">
<link rel="preload" as="image" href="./assets/sunflower.svg">
<link rel="preload" as="audio" href="./assets/BGM.mp3">
<link rel="preload" as="audio" href="./assets/END.mp3">
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
<title>ã‚€ã‚‹ã ã£ã—ã‚…ï¼</title>
<script src="https://cdn.tailwindcss.com"></script>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap');
  body { font-family:'Inter',sans-serif; touch-action:manipulation; overflow:hidden; overscroll-behavior:none; background:#1a202c; }
  canvas { display:block; }
  .control-button { transition: background-color .1s, transform .1s; }
  .control-button:active { transform: scale(.95); background:#2c5282; }
  .pause-button { transition: background-color .1s, transform .1s; }
  .pause-button:active { transform: scale(.95); }
  .icon-inline { display:inline-block; width:1.1em; height:1.1em; vertical-align:-0.15em; margin-left:.15em; }
  .no-select {
    user-select: none;
    -webkit-user-select: none;
    -webkit-touch-callout: none;
  }
  .no-highlight { -webkit-tap-highlight-color: transparent; }
</style>
</head>
<body class="bg-gray-800 flex flex-col items-center justify-start min-h-screen pt-3 sm:pt-4 pb-28">

<div class="w-full text-center bg-gray-900 text-gray-300 text-[11px] py-1 shadow-md">
  â€»æœ¬ä½œå“ã¯ <a href="https://kuronekotsuki.booth.pm/items/4672957" target="_blank" rel="noopener noreferrer" class="underline hover:text-white transition">ï½¢ãƒ ãƒ«ãƒ«ï½£</a> ã‚’ãƒ¢ãƒãƒ¼ãƒ•ã«ã—ãŸéå…¬å¼ãƒ•ã‚¡ãƒ³ä½œå“ã§ã™ã€‚<br class="sm:hidden">
  æ¨©åˆ©è€…æ§˜ã¨ã¯ä¸€åˆ‡é–¢ä¿‚ã‚ã‚Šã¾ã›ã‚“ã€‚<br>
  â€»éŸ³ãŒå‡ºã¾ã™ã€‚ã”æ³¨æ„ãã ã•ã„ã€‚
</div>

<div class="w-full max-w-[1024px] p-3 bg-white rounded-t-lg shadow-md">
  <div class="flex items-center justify-between gap-3">
    <div class="text-left">
      <span class="text-xl sm:text-2xl font-bold text-blue-600">
        ã‚¹ã‚³ã‚¢: <span id="score" class="inline-block min-w-[60px] text-right font-mono">0</span>
      </span>
    </div>
    <div class="flex items-center gap-3 shrink-0">
      <span id="highScore" class="text-xs text-gray-500 block">ãƒã‚¤ã‚¹ã‚³ã‚¢: 0</span>
      <button id="pauseButton" class="pause-button px-3 py-2 sm:px-4 sm:py-2 bg-yellow-500 text-white font-bold rounded-lg shadow-md text-sm">
        ã¡ã‚‡ã£ã¨ä¼‘æ†©
      </button>
    </div>
  </div>
</div>

<div class="relative w-full max-w-[1024px] mt-2">
  <canvas id="gameCanvas" class="rounded-b-lg shadow-md"></canvas>

  <div id="startScreen" class="absolute inset-0 bg-black bg-opacity-70 flex-col justify-center items-center rounded-b-lg text-white p-8 text-center flex">
    <h2 class="text-5xl font-bold mb-6">ã‚€ã‚‹ã ã£ã—ã‚…ï¼</h2>
    <p class="text-lg mb-4">ãƒœã‚¿ãƒ³ã§ã‚¸ãƒ£ãƒ³ãƒ—ï¼ç©ºä¸­ã§ã‚‚ã†ä¸€å›ã§2æ®µã‚¸ãƒ£ãƒ³ãƒ—ï¼</p>
    <p class="text-lg mb-8">éšœå®³ç‰©ã‚’ã‚ˆã‘ã¾ãã‚ã†ï¼</p>
    <button id="startButton" class="px-8 py-4 bg-green-600 text-white font-bold rounded-lg shadow-lg text-2xl hover:bg-green-700 transition-colors">
      ã‚²ãƒ¼ãƒ ã‚¹ã‚¿ãƒ¼ãƒˆ
    </button>
  </div>

  <div id="pauseOverlay" class="absolute inset-0 bg-black bg-opacity-50 flex-col justify-center items-center rounded-b-lg text-white p-8 text-center hidden">
    <h2 class="text-4xl font-bold mb-4">ä¸€æ™‚åœæ­¢ä¸­</h2>
    <p class="text-xl">(ã€Œã¡ã‚‡ã£ã¨ä¼‘æ†©ã€ãƒœã‚¿ãƒ³ã§å†é–‹)</p>
  </div>

  <div id="gameOverScreen" class="absolute inset-0 bg-black bg-opacity-50 flex-col justify-center items-center rounded-lg text-white p-8 text-center hidden">
    <h2 class="text-4xl font-bold mb-4">ãŒã‚ãŠã¹ã‚‰</h2>
    <p class="text-xl mb-6">ã‚¹ã‚³ã‚¢: <span id="finalScore">0</span></p>
    <div class="flex flex-wrap justify-center gap-3">
      <button id="restartButton" class="px-8 py-4 bg-blue-600 text-white font-bold rounded-lg shadow-lg text-xl hover:bg-blue-700 transition-colors">
        ãƒªã‚¹ã‚¿ãƒ¼ãƒˆ
      </button>
      <a id="shareButton" href="#" target="_blank" rel="noopener noreferrer" class="px-8 py-4 bg-black text-white font-bold rounded-lg shadow-lg text-xl hover:bg-gray-900 transition-colors">
        Xã§ã‚¹ã‚³ã‚¢ã‚’ã‚·ã‚§ã‚¢
      </a>
    </div>
  </div>
</div>

<div class="w-full max-w-[1024px] text-gray-200 text-sm mt-3 mb-20 px-1 leading-relaxed">
  <p class="mb-1">
    ã²ã¾ã‚ã‚Š
    <img src="./assets/sunflower.svg" alt="sunflower" class="icon-inline">
    ã‚„ãƒ–ãƒ«ãƒ¼ãƒ™ãƒªãƒ¼
    <img src="./assets/blueberry.svg" alt="blueberry" class="icon-inline">
    ã‚’é¿ã‘ãªãŒã‚‰ãƒã‚¤ã‚¹ã‚³ã‚¢ã‚’ç›®æŒ‡ãã†ï¼
  </p>
  <p>
    ãŸã¾ã«è½ã¡ã¦ã‚‹ã©ã‚“ãã‚Š<span class="icon-inline" aria-hidden="true" style="width:1.1em;height:1.1em;">ğŸŒ°</span>ã¯æ‹¾ã„ãŸã„ã­ã€‚
  </p>
</div>

<div class="w-full max-w-[1024px] flex justify-center p-4 fixed bottom-0 left-1/2 -translate-x-1/2 no-select no-highlight">
  <button id="jumpButton" class="control-button w-full py-12 bg-blue-600 text-white font-bold rounded-lg shadow-lg text-2xl no-select" draggable="false">
    ã‚¸ãƒ£ãƒ³ãƒ—
  </button>
</div>

<script>
// === åŸºæœ¬ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ— ===
const canvas=document.getElementById('gameCanvas');
const ctx=canvas.getContext('2d');
const scoreEl=document.getElementById('score');
const highScoreEl=document.getElementById('highScore');
const gameOverScreen=document.getElementById('gameOverScreen');
const finalScoreEl=document.getElementById('finalScore');
const restartButton=document.getElementById('restartButton');
const shareButton=document.getElementById('shareButton');
const jumpButton=document.getElementById('jumpButton');
const pauseButton=document.getElementById('pauseButton');
const pauseOverlay=document.getElementById('pauseOverlay');
const startScreen=document.getElementById('startScreen');
const startButton=document.getElementById('startButton');

function loadImg(src){const i=new Image();i.src=src;return i;}
const SPRITES={blueberry:loadImg('./assets/blueberry.svg'),sunflower:loadImg('./assets/sunflower.svg')};

// === ã‚ªãƒ¼ãƒ‡ã‚£ã‚ª ===
let audioStarted=false,bgmAudio,endAudio;
async function startAudio(){
 if(audioStarted)return;
 try{
  bgmAudio=new Audio('./assets/BGM.mp3');bgmAudio.volume=0.5;bgmAudio.loop=true;
  await bgmAudio.play();
  endAudio=new Audio('./assets/END.mp3');endAudio.volume=0.5;
  audioStarted=true;
 }catch(e){console.error(e);}
}

// === ã‚µã‚¤ã‚º ===
const gameWidth=Math.min(canvas.parentElement.clientWidth,1024);
const gameHeight=Math.max(280,Math.round(gameWidth*0.32));
canvas.width=gameWidth;canvas.height=gameHeight;

// === ç©ºã®ãƒ†ãƒ¼ãƒ ===
const THEMES={morning:{top:[160,210,235],bottom:[247,250,252]},evening:{top:[246,173,85],bottom:[253,230,138]},night:{top:[45,55,90],bottom:[20,25,50]}};
let skyCurrent={top:[...THEMES.morning.top],bottom:[...THEMES.morning.bottom]},skyTarget={top:[...THEMES.morning.top],bottom:[...THEMES.morning.bottom]};
const skyLerpSpeed=0.02; // â† ãƒ•ã‚§ãƒ¼ãƒ‰1.5å€ã‚†ã£ãã‚Š
let phaseName='morning';
function setBackgroundTheme(k){const t=THEMES[k]||THEMES.morning;skyTarget={top:[...t.top],bottom:[...t.bottom]};phaseName=k;}
function drawSky(df){
 const t=Math.min(1,skyLerpSpeed*df);
 for(let i=0;i<3;i++){skyCurrent.top[i]+=(skyTarget.top[i]-skyCurrent.top[i])*t;skyCurrent.bottom[i]+=(skyTarget.bottom[i]-skyCurrent.bottom[i])*t;}
 const g=ctx.createLinearGradient(0,0,0,gameHeight);
 const top=`rgb(${skyCurrent.top.map(x=>x|0).join(',')})`,bot=`rgb(${skyCurrent.bottom.map(x=>x|0).join(',')})`;
 g.addColorStop(0,top);g.addColorStop(0.8,bot);
 ctx.fillStyle=g;ctx.fillRect(0,0,gameWidth,gameHeight);
}

// === æ›²ã‚¿ã‚¤ãƒŸãƒ³ã‚° ===
const EVENING_MARK_S=96; // â† 1ç§’é…ã‚‰ã›
const EPS=0.25;
let lastAudioTime=0,loopCount=0,eveningTriggered=false;
function resetAudioSyncState(){lastAudioTime=0;loopCount=0;eveningTriggered=false;setBackgroundTheme('morning');}
function updateSkyByMusic(){
 if(!bgmAudio)return;
 const t=bgmAudio.currentTime||0;
 if(!eveningTriggered&&t>=EVENING_MARK_S-EPS){setBackgroundTheme('evening');eveningTriggered=true;}
 if(t+EPS<lastAudioTime){loopCount++;eveningTriggered=false;setBackgroundTheme(loopCount%2===1?'night':'morning');}
 lastAudioTime=t;
}

// === é›² ===
let clouds=Array.from({length:6},()=>({x:Math.random()*gameWidth,y:40+Math.random()*Math.max(90,gameHeight*0.35),speed:0.12+Math.random()*0.18,size:60+Math.random()*60}));
function drawClouds(df){
 const a=(phaseName==='night')?0.35:0.45;ctx.fillStyle=`rgba(255,255,255,${a})`;
 for(const c of clouds){c.x-=c.speed*df;if(c.x<-200)c.x=gameWidth+100;ctx.beginPath();ctx.ellipse(c.x,c.y,c.size,c.size*0.6,0,0,Math.PI*2);ctx.fill();}
}

// === ä»¥ä¸‹ã‚²ãƒ¼ãƒ å‡¦ç†ã¯å‰å›ç‰ˆã¨åŒã˜ï¼ˆã©ã‚“ãã‚Šå«ã‚€ï¼‰ ===
// çœç•¥éƒ¨åˆ†ã¯ãã®ã¾ã¾ã§OKã€‚ä¸Šã®å¤‰æ›´ã ã‘åæ˜ æ¸ˆã¿ã€‚
</script>
</body>
</html>